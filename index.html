    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Supabase configuration
        const SUPABASE_URL = 'https://pcesrqdyiixnvmkqngiz.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBjZXNycWR5aWl4bnZta3FuZ2l6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA2NDM2NjMsImV4cCI6MjA2NjIxOTY2M30.pCAcgj-bY-ZsSBUK0iFO51MWYUsKKr1AQut3C5yH4pE';
        const PASSWORD = '1612!';

        // Initialize Supabase
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
            auth: {
                persistSession: true,
                autoRefreshToken: true
            }
        });

        // Data storage
        let currentSection = 'home';
        let editingItem = null;
        let isAuthenticated = false;
        let isUploading = false;
        let currentUser = null; // Usuario logueado
        let viewingUserId = null; // ID del usuario que estamos viendo
        let viewingUserProfile = null; // Perfil del usuario que estamos viendo
        let isOwnerView = true; // Si estamos viendo nuestro propio perfil
        let followingUsers = []; // IDs de usuarios que seguimos
        let userFollowCounts = {}; // Cache de contadores de follows
        let customPages = []; // Páginas personalizadas del usuario
        let notifications = []; // Notificaciones del usuario
        let unreadNotifications = 0; // Contador de notificaciones no leídas
        let data = {
            playlists: [],
            movies: [],
            books: [],
            articles: [],
            posts: [],
            media: []
        };

        // Auth functions
        async function checkAuthStatus() {
            const { data: { user } } = await supabaseClient.auth.getUser();
            if (user) {
                currentUser = user;
                const { data: profile } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .eq('id', user.id)
                    .single();
                
                if (profile) {
                    currentUser.profile = profile;
                }
                
                console.log('Usuario autenticado:', currentUser);
                updateUIForAuth(true);
                return true;
            }
            return false;
        }

        function updateUIForAuth(isLoggedIn) {
            // Actualizar UI basado en estado de autenticación
            if (isLoggedIn && currentUser) {
                // Usuario logueado
                console.log('Actualizando UI para usuario:', currentUser.email);
                isAuthenticated = true;
                
                // Actualizar el botón de auth
                document.getElementById('authIcon').textContent = '👤';
                document.getElementById('authText').textContent = currentUser.profile?.username || currentUser.email.split('@')[0];
                
                showActionButtons();
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email,
                    password
                });
                
                if (error) throw error;
                
                currentUser = data.user;
                await checkAuthStatus();
                await loadFollowRelationships(); // Cargar follows
                closeAuthModal();
                showUploadStatus('Sesión iniciada correctamente', 'success');
                
                // Ocultar landing page si existe
                const landingPage = document.getElementById('landingPage');
                if (landingPage) {
                    landingPage.classList.add('hidden');
                    setTimeout(() => {
                        landingPage.style.display = 'none';
                    }, 500);
                }
                
                // Recargar datos del usuario específico
                await loadAllData(currentUser.id);
                await updateProfileHeader(); // Actualizar header
                renderAllSections();
                
            } catch (error) {
                showAuthError(error.message);
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const fullName = document.getElementById('registerName').value;
            const username = document.getElementById('registerUsername').value;
            
            try {
                // Verificar si el username ya existe
                const { data: existingUser } = await supabaseClient
                    .from('profiles')
                    .select('username')
                    .eq('username', username)
                    .single();
                
                if (existingUser) {
                    throw new Error('El nombre de usuario ya está en uso');
                }
                
                // Registrar usuario
                const { data, error } = await supabaseClient.auth.signUp({
                    email,
                    password,
                    options: {
                        data: {
                            full_name: fullName,
                            username: username
                        }
                    }
                });
                
                if (error) throw error;
                
                // Actualizar perfil con username
                if (data.user) {
                    await supabaseClient
                        .from('profiles')
                        .update({ username, full_name: fullName })
                        .eq('id', data.user.id);
                }
                
                showAuthError('¡Registro exitoso! Revisa tu email para confirmar tu cuenta.', 'success');
                
            } catch (error) {
                showAuthError(error.message);
            }
        }

        function switchAuthTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const loginTab = document.getElementById('loginTab');
            const registerTab = document.getElementById('registerTab');
            
            if (tab === 'login') {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                loginTab.classList.add('active');
                registerTab.classList.remove('active');
                loginTab.style.color = 'var(--text-primary)';
                registerTab.style.color = 'var(--text-secondary)';
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                registerTab.classList.add('active');
                loginTab.classList.remove('active');
                registerTab.style.color = 'var(--text-primary)';
                loginTab.style.color = 'var(--text-secondary)';
            }
        }

        function showAuthError(message, type = 'error') {
            const errorDiv = document.getElementById('authError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            errorDiv.style.color = type === 'success' ? '#10b981' : '#ef4444';
            
            if (type === 'success') {
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 5000);
            }
        }

        function openAuthModal() {
            document.getElementById('authModal').classList.add('active');
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
            document.getElementById('authError').style.display = 'none';
            // Limpiar formularios
            document.getElementById('loginForm').reset();
            document.getElementById('registerForm').reset();
        }

        // Follow System Functions
        async function loadFollowRelationships() {
            if (!currentUser) return;
            
            try {
                // Cargar usuarios que seguimos
                const { data: following } = await supabaseClient
                    .from('follows')
                    .select('following_id')
                    .eq('follower_id', currentUser.id);
                
                followingUsers = following ? following.map(f => f.following_id) : [];
            } catch (error) {
                console.error('Error loading follow relationships:', error);
            }
        }

        async function toggleFollow(userId) {
            if (!currentUser) {
                openAuthModal();
                return;
            }
            
            if (userId === currentUser.id) {
                showUploadStatus('No puedes seguirte a ti mismo', 'error');
                return;
            }
            
            const isFollowing = followingUsers.includes(userId);
            
            try {
                if (isFollowing) {
                    // Dejar de seguir
                    const { error } = await supabaseClient
                        .from('follows')
                        .delete()
                        .eq('follower_id', currentUser.id)
                        .eq('following_id', userId);
                    
                    if (error) throw error;
                    
                    followingUsers = followingUsers.filter(id => id !== userId);
                    showUploadStatus('Has dejado de seguir', 'success');
                } else {
                    // Seguir
                    const { error } = await supabaseClient
                        .from('follows')
                        .insert({
                            follower_id: currentUser.id,
                            following_id: userId
                        });
                    
                    if (error) throw error;
                    
                    followingUsers.push(userId);
                    showUploadStatus('Ahora sigues a este usuario', 'success');
                }
                
                // Actualizar UI
                updateFollowButton(userId);
                updateFollowCounts(userId);
                
                // Actualizar botones en resultados de búsqueda si existen
                const searchButtons = document.querySelectorAll(`.follow-button-small[onclick*="${userId}"]`);
                searchButtons.forEach(button => {
                    const isNowFollowing = followingUsers.includes(userId);
                    button.className = `follow-button-small ${isNowFollowing ? 'following' : 'not-following'}`;
                });
                
            } catch (error) {
                console.error('Error toggling follow:', error);
                showUploadStatus('Error al procesar la solicitud', 'error');
            }
        }

        async function getFollowCounts(userId) {
            // Verificar cache primero
            if (userFollowCounts[userId]) {
                return userFollowCounts[userId];
            }
            
            try {
                // Contar seguidores
                const { count: followersCount } = await supabaseClient
                    .from('follows')
                    .select('*', { count: 'exact', head: true })
                    .eq('following_id', userId);
                
                // Contar seguidos
                const { count: followingCount } = await supabaseClient
                    .from('follows')
                    .select('*', { count: 'exact', head: true })
                    .eq('follower_id', userId);
                
                const counts = {
                    followers: followersCount || 0,
                    following: followingCount || 0
                };
                
                // Guardar en cache
                userFollowCounts[userId] = counts;
                
                return counts;
            } catch (error) {
                console.error('Error getting follow counts:', error);
                return { followers: 0, following: 0 };
            }
        }

        function updateFollowButton(userId) {
            const button = document.getElementById('followButton');
            if (!button) return;
            
            const isFollowing = followingUsers.includes(userId);
            
            button.className = isFollowing ? 'following' : 'not-following';
            button.style.background = isFollowing ? 'transparent' : 'var(--gradient-accent)';
            button.style.border = isFollowing ? '1px solid var(--accent)' : 'none';
            button.style.color = isFollowing ? 'var(--accent)' : 'white';
        }

        async function updateFollowCounts(userId) {
            // Limpiar cache para forzar recarga
            delete userFollowCounts[userId];
            
            // Si estamos viendo ese perfil, actualizar UI
            if (viewingUserId === userId) {
                await updateProfileHeader();
            }
        }

        async function showFollowersList(userId = null) {
            const targetUserId = userId || viewingUserId || currentUser?.id;
            if (!targetUserId) return;
            
            try {
                // Obtener lista de seguidores
                const { data: followers } = await supabaseClient
                    .from('follows')
                    .select(`
                        follower_id,
                        profiles!follows_follower_id_fkey (
                            id,
                            username,
                            full_name,
                            avatar_url
                        )
                    `)
                    .eq('following_id', targetUserId);
                
                showFollowsModal('Seguidores', followers || []);
            } catch (error) {
                console.error('Error loading followers:', error);
            }
        }

        async function showFollowingList(userId = null) {
            const targetUserId = userId || viewingUserId || currentUser?.id;
            if (!targetUserId) return;
            
            try {
                // Obtener lista de seguidos
                const { data: following } = await supabaseClient
                    .from('follows')
                    .select(`
                        following_id,
                        profiles!follows_following_id_fkey (
                            id,
                            username,
                            full_name,
                            avatar_url
                        )
                    `)
                    .eq('follower_id', targetUserId);
                
                showFollowsModal('Siguiendo', following || []);
            } catch (error) {
                console.error('Error loading following:', error);
            }
        }

        function showFollowsModal(title, users) {
            const modal = document.getElementById('followsModal');
            const modalTitle = document.getElementById('followsModalTitle');
            const followsList = document.getElementById('followsList');
            
            modalTitle.textContent = title;
            
            if (users.length === 0) {
                followsList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No hay usuarios para mostrar</p>';
            } else {
                followsList.innerHTML = users.map(item => {
                    const profile = item.profiles;
                    if (!profile) return '';
                    
                    const initials = (profile.full_name || 'Usuario')
                        .split(' ')
                        .map(n => n[0])
                        .join('')
                        .toUpperCase()
                        .slice(0, 2);
                    
                    return `
                        <div class="follow-item" onclick="navigateToProfile('${profile.id}'); closeFollowsModal();">
                            <div class="follow-avatar">${initials}</div>
                            <div class="follow-info">
                                <div class="follow-name">${profile.full_name || 'Usuario'}</div>
                                <div class="follow-username">@${profile.username || 'usuario'}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            modal.classList.add('active');
        }

        function closeFollowsModal() {
            document.getElementById('followsModal').classList.remove('active');
        }

        // Search Users Functions
        async function searchUsers() {
            const query = document.getElementById('searchInput').value.trim();
            const resultsContainer = document.getElementById('searchResults');
            
            if (!query) {
                resultsContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Ingresa un término de búsqueda</p>';
                return;
            }
            
            // Mostrar loader
            showLoader(resultsContainer);
            
            try {
                // Buscar en username y full_name
                const { data: users, error } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .or(`username.ilike.%${query}%,full_name.ilike.%${query}%`)
                    .limit(20);
                
                if (error) throw error;
                
                if (!users || users.length === 0) {
                    resultsContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No se encontraron usuarios</p>';
                    return;
                }
                
                // Renderizar resultados
                resultsContainer.innerHTML = await Promise.all(users.map(async user => {
                    const counts = await getFollowCounts(user.id);
                    const isFollowing = followingUsers.includes(user.id);
                    const isCurrentUser = user.id === currentUser?.id;
                    
                    const initials = (user.full_name || 'Usuario')
                        .split(' ')
                        .map(n => n[0])
                        .join('')
                        .toUpperCase()
                        .slice(0, 2);
                    
                    return `
                        <div class="user-search-card" onclick="navigateToProfile('${user.id}')">
                            <div class="user-search-avatar">${initials}</div>
                            <div class="user-search-info">
                                <div class="user-search-name">${user.full_name || 'Usuario'}</div>
                                <div class="user-search-username">@${user.username || 'usuario'}</div>
                                <div class="user-search-stats">
                                    <span>${counts.followers} seguidores</span>
                                    <span>${counts.following} siguiendo</span>
                                </div>
                            </div>
                            ${!isCurrentUser && currentUser ? `
                                <button class="follow-button-small ${isFollowing ? 'following' : 'not-following'}" 
                                        onclick="event.stopPropagation(); toggleFollow('${user.id}')">
                                </button>
                            ` : ''}
                        </div>
                    `;
                })).then(cards => cards.join(''));
                
            } catch (error) {
                console.error('Error searching users:', error);
                resultsContainer.innerHTML = '<p style="text-align: center; color: #ef4444;">Error al buscar usuarios</p>';
            }
        }

        // Búsqueda en tiempo real (debounced)
        let searchTimeout;
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        if (e.target.value.trim()) {
                            searchUsers();
                        }
                    }, 300);
                });
                
                // Buscar con Enter
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        searchUsers();
                    }
                });
            }
        });

        // Check for saved authentication
        function checkSavedAuth() {
            const authExpiry = localStorage.getItem('eac_auth_expiry');
            if (authExpiry && new Date().getTime() < parseInt(authExpiry)) {
                isAuthenticated = true;
                return true;
            }
            return false;
        }

        // Save authentication
        function saveAuth() {
            // Save auth for 7 days
            const expiryTime = new Date().getTime() + (7 * 24 * 60 * 60 * 1000);
            localStorage.setItem('eac_auth_expiry', expiryTime);
        }

        // Initialize app
        async function initializeApp() {
            console.log('Inicializando app...');
            
            // Verificar si el usuario ya ha visto la landing page
            const hasSeenLanding = sessionStorage.getItem('hasSeenLanding');
            const landingPage = document.getElementById('landingPage');
            
            // Primero verificar si hay un usuario autenticado
            const hasUser = await checkAuthStatus();
            
            console.log('Usuario encontrado:', hasUser);
            
            // Si no hay usuario y no ha visto la landing, mostrarla
            if (!hasUser && !hasSeenLanding) {
                // Landing page ya se muestra por defecto
                return;
            } else {
                // Ocultar landing page
                if (landingPage) {
                    landingPage.classList.add('hidden');
                    setTimeout(() => {
                        landingPage.style.display = 'none';
                    }, 500);
                }
            }
            
            // Si no hay usuario autenticado, verificar autenticación legacy
            if (!hasUser) {
                checkSavedAuth();
            }
            
            // Cargar relaciones de follows si hay usuario
            if (currentUser) {
                await loadFollowRelationships();
                // Cargar datos del usuario actual
                await loadAllData(currentUser.id);
                // Cargar páginas personalizadas
                await loadCustomPages();
                // Cargar notificaciones
                await loadNotifications();
            }
            
            // Actualizar header DESPUÉS de cargar datos
            await updateProfileHeader();
            
            renderAllSections();
            updateFabVisibility();
            
            // Show action buttons if authenticated
            if (isAuthenticated || currentUser) {
                showActionButtons();
            }
        }

        // Show auth modal from landing page
        function showAuthFromLanding(tab) {
            const landingPage = document.getElementById('landingPage');
            
            // Marcar que ya vio la landing
            sessionStorage.setItem('hasSeenLanding', 'true');
            
            // Ocultar landing con animación
            landingPage.classList.add('hidden');
            setTimeout(() => {
                landingPage.style.display = 'none';
                
                // Abrir modal de auth en el tab correcto
                openAuthModal();
                if (tab === 'register') {
                    switchAuthTab('register');
                }
            }, 500);
        }

        // Quick Post Functions
        function openQuickPost() {
            if (!currentUser) {
                openAuthModal();
                return;
            }
            
            const modal = document.getElementById('quickPostModal');
            const avatar = document.getElementById('quickPostAvatar');
            
            // Actualizar avatar
            if (currentUser && currentUser.profile) {
                const initials = (currentUser.profile.full_name || 'Usuario')
                    .split(' ')
                    .map(n => n[0])
                    .join('')
                    .toUpperCase()
                    .slice(0, 2);
                avatar.textContent = initials;
            }
            
            modal.classList.add('active');
            document.getElementById('quickPostContent').focus();
        }

        function closeQuickPost() {
            const modal = document.getElementById('quickPostModal');
            modal.classList.remove('active');
            
            // Limpiar formulario
            document.getElementById('quickPostContent').value = '';
            document.getElementById('quickPostMedia').value = '';
            document.getElementById('quickPostMediaPreview').style.display = 'none';
            updateQuickPostButton();
        }

        function handleQuickPostMedia(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const preview = document.getElementById('quickPostMediaPreview');
            const container = document.getElementById('quickPostMediaContainer');
            
            // Mostrar preview
            const reader = new FileReader();
            reader.onload = function(e) {
                if (file.type.startsWith('video/')) {
                    container.innerHTML = `<video src="${e.target.result}" controls style="width: 100%;"></video>`;
                } else {
                    container.innerHTML = `<img src="${e.target.result}" style="width: 100%;">`;
                }
                preview.style.display = 'block';
                updateQuickPostButton();
            };
            reader.readAsDataURL(file);
        }

        function removeQuickPostMedia() {
            document.getElementById('quickPostMedia').value = '';
            document.getElementById('quickPostMediaPreview').style.display = 'none';
            updateQuickPostButton();
        }

        function updateQuickPostButton() {
            const content = document.getElementById('quickPostContent').value;
            const hasMedia = document.getElementById('quickPostMedia').files.length > 0;
            const button = document.getElementById('quickPostButton');
            button.disabled = !content.trim() && !hasMedia;
        }

        async function createQuickPost() {
            const content = document.getElementById('quickPostContent').value;
            const mediaFile = document.getElementById('quickPostMedia').files[0];
            
            if (!content && !mediaFile) return;
            
            const postButton = document.getElementById('quickPostButton');
            postButton.disabled = true;
            postButton.textContent = 'Publicando...';
            
            try {
                const post = {
                    content: content || '',
                    media: null,
                    media_type: null,
                    user_id: getCurrentUserId()
                };
                
                if (mediaFile) {
                    // Validar tipo de archivo
                    const allowedImages = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
                    const allowedVideos = ['video/mp4', 'video/webm'];
                    
                    if (![...allowedImages, ...allowedVideos].includes(mediaFile.type)) {
                        showUploadStatus('Tipo de archivo no permitido', 'error');
                        throw new Error('Invalid file type');
                    }
                    
                    post.media = await uploadFile(mediaFile, 'posts');
                    post.media_type = mediaFile.type.startsWith('video/') ? 'video' : 'image';
                }
                
                const { error } = await supabaseClient
                    .from('posts')
                    .insert([post]);
                if (error) throw error;
                
                closeQuickPost();
                showUploadStatus('Post publicado', 'success');
                
                // Recargar posts si estamos en esa sección
                if (currentSection === 'posts') {
                    await loadAllData();
                    renderPosts();
                }
                
            } catch (error) {
                console.error('Error creating post:', error);
                showUploadStatus('Error al publicar', 'error');
            } finally {
                postButton.disabled = false;
                postButton.textContent = 'Publicar';
            }
        }

        // Event listener para el textarea del quick post
        document.addEventListener('DOMContentLoaded', () => {
            const quickPostContent = document.getElementById('quickPostContent');
            if (quickPostContent) {
                quickPostContent.addEventListener('input', updateQuickPostButton);
            }
        });

        // Notifications Functions
        async function loadNotifications() {
            if (!currentUser) return;
            
            try {
                // Por ahora simularemos algunas notificaciones
                // En el futuro, esto vendría de Supabase
                notifications = [
                    {
                        id: 1,
                        type: 'follow',
                        message: 'Te ha empezado a seguir',
                        user: 'Usuario Demo',
                        time: new Date(Date.now() - 3600000), // Hace 1 hora
                        read: false
                    },
                    {
                        id: 2,
                        type: 'like',
                        message: 'Le gustó tu post',
                        user: 'Otro Usuario',
                        time: new Date(Date.now() - 7200000), // Hace 2 horas
                        read: true
                    }
                ];
                
                updateNotificationBadge();
                renderNotifications();
            } catch (error) {
                console.error('Error loading notifications:', error);
            }
        }

        function updateNotificationBadge() {
            unreadNotifications = notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notificationBadge');
            
            if (unreadNotifications > 0) {
                badge.textContent = unreadNotifications > 9 ? '9+' : unreadNotifications;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        function toggleNotifications() {
            const panel = document.getElementById('notificationsPanel');
            panel.classList.toggle('active');
            
            // Marcar todas como leídas cuando se abre el panel
            if (panel.classList.contains('active')) {
                notifications.forEach(n => n.read = true);
                updateNotificationBadge();
                renderNotifications();
            }
        }

        function renderNotifications() {
            const list = document.getElementById('notificationsList');
            
            if (notifications.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 2rem;">No hay notificaciones</p>';
                return;
            }
            
            list.innerHTML = notifications.map(notification => {
                const icon = notification.type === 'follow' ? '👤' : 
                            notification.type === 'like' ? '❤️' : 
                            notification.type === 'comment' ? '💬' : '🔔';
                
                return `
                    <div class="notification-item ${!notification.read ? 'unread' : ''}" onclick="handleNotificationClick(${notification.id})">
                        <div class="notification-content">
                            <div class="notification-icon">${icon}</div>
                            <div class="notification-text">
                                <div class="notification-title">${notification.user}</div>
                                <div class="notification-message">${notification.message}</div>
                                <div class="notification-time">${formatDate(notification.time)}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function handleNotificationClick(notificationId) {
            // Aquí podrías navegar al contenido relacionado con la notificación
            console.log('Notification clicked:', notificationId);
        }

        // Custom Pages Functions
        function openCustomPageModal() {
            if (!currentUser) {
                openAuthModal();
                return;
            }
            
            document.getElementById('customPageModal').classList.add('active');
            
            // Reset form
            document.getElementById('customPageForm').reset();
            document.getElementById('selectedIcon').value = '📄';
            document.getElementById('selectedContentType').value = 'all';
            
            // Configurar icon picker con event delegation
            const iconPicker = document.getElementById('iconPicker');
            if (!iconPicker.hasAttribute('data-initialized')) {
                iconPicker.addEventListener('click', function(e) {
                    const iconOption = e.target.closest('.icon-option');
                    if (iconOption) {
                        // Remover selección previa
                        document.querySelectorAll('.icon-option').forEach(btn => {
                            btn.classList.remove('selected');
                        });
                        
                        // Seleccionar nuevo icono
                        iconOption.classList.add('selected');
                        document.getElementById('selectedIcon').value = iconOption.dataset.icon;
                    }
                });
                iconPicker.setAttribute('data-initialized', 'true');
            }
            
            // Seleccionar el primer icono por defecto
            const firstIcon = document.querySelector('.icon-option');
            if (firstIcon) {
                firstIcon.classList.add('selected');
            }
        }

        function closeCustomPageModal() {
            document.getElementById('customPageModal').classList.remove('active');
            document.getElementById('customPageForm').reset();
            document.querySelectorAll('.icon-option').forEach(btn => btn.classList.remove('selected'));
            document.querySelectorAll('.content-type-option').forEach(btn => btn.classList.remove('selected'));
            document.querySelector('.content-type-option[data-type="all"]').classList.add('selected');
        }

        function selectContentType(type) {
            document.querySelectorAll('.content-type-option').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`.content-type-option[data-type="${type}"]`).classList.add('selected');
            document.getElementById('selectedContentType').value = type;
        }

        async function handleCreateCustomPage(event) {
            event.preventDefault();
            
            const submitButton = event.target.querySelector('.form-submit');
            submitButton.disabled = true;
            submitButton.textContent = 'Creando...';
            
            try {
                const pageData = {
                    name: document.getElementById('customPageName').value,
                    icon: document.getElementById('selectedIcon').value || '📄',
                    content_type: document.getElementById('selectedContentType').value || 'all',
                    description: document.getElementById('customPageDescription').value,
                    user_id: getCurrentUserId()
                };
                
                // Verificar si la tabla existe primero
                const { data: tables } = await supabaseClient
                    .from('information_schema.tables')
                    .select('table_name')
                    .eq('table_schema', 'public')
                    .eq('table_name', 'custom_pages')
                    .single();
                
                if (!tables) {
                    // Si la tabla no existe, guardamos localmente
                    console.warn('Tabla custom_pages no existe. Guardando localmente.');
                    
                    // Generar ID único
                    pageData.id = 'local-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                    pageData.created_at = new Date().toISOString();
                    
                    // Guardar en array local
                    customPages.push(pageData);
                    
                    // Guardar en localStorage temporalmente (solo para demostración)
                    try {
                        const savedPages = JSON.parse(sessionStorage.getItem('nexus_custom_pages') || '[]');
                        savedPages.push(pageData);
                        sessionStorage.setItem('nexus_custom_pages', JSON.stringify(savedPages));
                    } catch (e) {
                        console.log('SessionStorage no disponible');
                    }
                    
                    // Agregar la página al sidebar
                    addCustomPageToSidebar(pageData);
                    
                    closeCustomPageModal();
                    showUploadStatus('Página creada localmente (tabla no existe en DB)', 'success');
                    
                } else {
                    // Si la tabla existe, intentar insertar
                    const { data, error } = await supabaseClient
                        .from('custom_pages')
                        .insert([pageData])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    
                    // Agregar la página al array local
                    customPages.push(data);
                    
                    // Agregar la página al sidebar
                    addCustomPageToSidebar(data);
                    
                    closeCustomPageModal();
                    showUploadStatus('Página creada exitosamente', 'success');
                }
                
            } catch (error) {
                console.error('Error creating custom page:', error);
                
                // Si hay error, intentar guardar localmente de todos modos
                const pageData = {
                    id: 'local-' + Date.now(),
                    name: document.getElementById('customPageName').value,
                    icon: document.getElementById('selectedIcon').value || '📄',
                    content_type: document.getElementById('selectedContentType').value || 'all',
                    description: document.getElementById('customPageDescription').value,
                    user_id: getCurrentUserId(),
                    created_at: new Date().toISOString()
                };
                
                customPages.push(pageData);
                addCustomPageToSidebar(pageData);
                
                closeCustomPageModal();
                showUploadStatus('Página guardada localmente', 'success');
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Crear Página';
            }
        }

        async function loadCustomPages() {
            if (!currentUser) return;
            
            try {
                // Intentar cargar de la base de datos
                const { data: pages, error } = await supabaseClient
                    .from('custom_pages')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false });
                
                if (error && error.code === '42P01') {
                    // Tabla no existe, cargar de sessionStorage si está disponible
                    console.log('Tabla custom_pages no existe, usando almacenamiento local');
                    try {
                        const savedPages = JSON.parse(sessionStorage.getItem('nexus_custom_pages') || '[]');
                        customPages = savedPages.filter(p => p.user_id === currentUser.id);
                    } catch (e) {
                        customPages = [];
                    }
                } else if (pages) {
                    customPages = pages;
                }
                
                // Agregar páginas al sidebar
                customPages.forEach(page => {
                    addCustomPageToSidebar(page);
                });
                
            } catch (error) {
                console.error('Error loading custom pages:', error);
                // En caso de error, usar array vacío
                customPages = [];
            }
        }

        function addCustomPageToSidebar(page) {
            const navItems = document.querySelector('.nav-items');
            
            // Verificar si la página ya existe en el sidebar
            if (document.querySelector(`[data-section="custom-${page.id}"]`)) return;
            
            const navItem = document.createElement('div');
            navItem.className = 'nav-item';
            navItem.dataset.section = `custom-${page.id}`;
            navItem.innerHTML = `
                <div class="nav-icon">${page.icon}</div>
                <span class="nav-text">${page.name}</span>
            `;
            
            // No agregamos event listener aquí porque usamos event delegation
            
            navItems.appendChild(navItem);
        }

        function navigateToCustomPage(page) {
            // Por ahora, mostrar la información de la página
            showUploadStatus(`Página "${page.name}" (${page.content_type})`, 'success');
            
            // TODO: Implementar navegación real cuando se cree la vista de páginas personalizadas
            console.log('Navegando a página personalizada:', page);
            
            // Actualizar nav activo
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-section="custom-${page.id}"]`)?.classList.add('active');
        }

        // Update FAB visibility based on section
        function updateFabVisibility() {
            const fab = document.getElementById('fab');
            if (currentSection !== 'home' && currentSection !== 'feed' && currentSection !== 'search' && isOwnerView) {
                fab.classList.add('visible');
            } else {
                fab.classList.remove('visible');
            }
        }

        // Check if user is authenticated before showing action buttons
        function showActionButtons() {
            // Update FAB visibility
            updateFabVisibility();
            
            // Show post composer only if viewing own profile
            const postComposer = document.getElementById('postComposer');
            if (postComposer && isOwnerView && currentUser) {
                postComposer.style.display = 'block';
            }
            
            // Re-render all sections to show/hide action buttons
            renderAllSections();
        }

        // Navigation
        document.addEventListener('DOMContentLoaded', () => {
            // Event delegation para todos los nav-items (incluyendo los dinámicos)
            document.querySelector('.nav-items').addEventListener('click', async (e) => {
                const navItem = e.target.closest('.nav-item');
                if (navItem) {
                    const section = navItem.dataset.section;
                    if (section) {
                        if (section === 'feed') {
                            await loadFeedData();
                        }
                        navigateToSection(section);
                    }
                }
            });

            // Section cards navigation
            document.querySelectorAll('.section-card').forEach(card => {
                card.addEventListener('click', () => {
                    const section = card.dataset.navigate;
                    navigateToSection(section);
                });
            });
        });

        function navigateToSection(section) {
            // Si es una página personalizada
            if (section && section.startsWith('custom-')) {
                const pageId = section.replace('custom-', '');
                const page = customPages.find(p => p.id === pageId);
                if (page) {
                    navigateToCustomPage(page);
                    return;
                }
            }
            
            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Buscar el elemento correcto y verificar que existe
            const navItem = document.querySelector(`[data-section="${section}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }

            // Update sections
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.classList.remove('active');
            });
            
            const targetSection = document.getElementById(section);
            if (targetSection) {
                targetSection.classList.add('active');
            }

            currentSection = section;
            updateFabVisibility();
        }

        // Get current user ID helper
        function getCurrentUserId() {
            return currentUser?.id || null;
        }

        // Password protection
        const fab = document.getElementById('fab');
        fab.addEventListener('click', () => {
            if (!isAuthenticated && !currentUser) {
                document.getElementById('passwordModal').classList.add('active');
                document.getElementById('passwordInput').focus();
            } else {
                openModal();
            }
        });

        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            const error = document.getElementById('passwordError');
            
            if (input === PASSWORD) {
                isAuthenticated = true;
                saveAuth(); // Save authentication
                document.getElementById('passwordModal').classList.remove('active');
                document.getElementById('passwordInput').value = '';
                error.classList.remove('visible');
                showActionButtons(); // Update UI to show action buttons
                
                // Check if there was a pending delete action
                if (window.pendingDelete) {
                    const { section, id } = window.pendingDelete;
                    window.pendingDelete = null;
                    deleteItem(section, id);
                } else {
                    openModal();
                }
            } else {
                error.classList.add('visible');
                document.getElementById('passwordInput').value = '';
            }
        }

        // Enter key support for password
        document.getElementById('passwordInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });

        // Show upload status
        function showUploadStatus(message, type = 'success') {
            const status = document.getElementById('uploadStatus');
            const icon = status.querySelector('.upload-status-icon');
            const text = status.querySelector('.upload-status-text');
            
            status.className = `upload-status show ${type}`;
            icon.textContent = type === 'success' ? '✓' : '✗';
            text.textContent = message;
            
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }

        function openModal(item = null) {
            editingItem = item;
            const form = document.getElementById('modalForm');
            const title = document.getElementById('modalTitle');
            
            form.innerHTML = getFormContent(currentSection);
            title.textContent = editingItem ? 'Editar' : 'Añadir';
            
            if (editingItem) {
                fillFormWithData(currentSection, editingItem);
            }
            
            // Initialize star ratings
            initializeStarRatings();
            
            modal.classList.add('active');
        }

        // Star Rating System
        function initializeStarRatings() {
            const movieRating = document.getElementById('movieRatingInput');
            const bookRating = document.getElementById('bookRatingInput');
            
            if (movieRating) {
                setupStarRating(movieRating, 'movieRating');
            }
            
            if (bookRating) {
                setupStarRating(bookRating, 'bookRating');
            }
        }

        function setupStarRating(container, inputId) {
            const stars = container.querySelectorAll('.star');
            const input = document.getElementById(inputId);
            
            stars.forEach((star, index) => {
                star.addEventListener('click', () => {
                    const rating = index + 1;
                    input.value = rating;
                    updateStars(stars, rating);
                });
                
                star.addEventListener('mouseenter', () => {
                    updateStars(stars, index + 1, true);
                });
            });
            
            container.addEventListener('mouseleave', () => {
                updateStars(stars, input.value);
            });
            
            // Set initial value if editing
            if (editingItem && editingItem.rating) {
                input.value = editingItem.rating;
                updateStars(stars, editingItem.rating);
            }
        }

        function updateStars(stars, rating, preview = false) {
            stars.forEach((star, index) => {
                if (preview) {
                    star.classList.toggle('preview', index < rating);
                    star.classList.remove('filled');
                } else {
                    star.classList.toggle('filled', index < rating);
                    star.classList.remove('preview');
                }
            });
        }

        function closeModal() {
            modal.classList.remove('active');
            document.getElementById('modalForm').reset();
            editingItem = null;
            isUploading = false;
        }

        function getFormContent(section) {
            switch(section) {
                case 'music':
                    return `
                        <div class="form-group">
                            <label class="form-label">URL de YouTube o Spotify</label>
                            <input type="text" class="form-input" id="playlistUrl" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Nombre de la playlist</label>
                            <input type="text" class="form-input" id="playlistName" placeholder="Mi playlist favorita" required>
                        </div>
                        <button type="submit" class="form-submit">Añadir Playlist</button>
                    `;
                case 'movies':
                    return `
                        <div class="form-group">
                            <label class="form-label">Título</label>
                            <input type="text" class="form-input" id="movieTitle" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Director</label>
                            <input type="text" class="form-input" id="movieDirector" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Año</label>
                            <input type="number" class="form-input" id="movieYear" min="1900" max="2025" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Calificación</label>
                            <div class="star-rating-input" id="movieRatingInput">
                                <span class="star" data-rating="1">★</span>
                                <span class="star" data-rating="2">★</span>
                                <span class="star" data-rating="3">★</span>
                                <span class="star" data-rating="4">★</span>
                                <span class="star" data-rating="5">★</span>
                            </div>
                            <input type="hidden" id="movieRating" value="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Reseña</label>
                            <textarea class="form-textarea" id="movieReview" required></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Póster</label>
                            <input type="file" class="form-input" accept="image/*" id="moviePoster">
                        </div>
                        <button type="submit" class="form-submit">${editingItem ? 'Actualizar' : 'Añadir'} Película</button>
                    `;
                case 'books':
                    return `
                        <div class="form-group">
                            <label class="form-label">Título</label>
                            <input type="text" class="form-input" id="bookTitle" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Autor</label>
                            <input type="text" class="form-input" id="bookAuthor" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Calificación</label>
                            <div class="star-rating-input" id="bookRatingInput">
                                <span class="star" data-rating="1">★</span>
                                <span class="star" data-rating="2">★</span>
                                <span class="star" data-rating="3">★</span>
                                <span class="star" data-rating="4">★</span>
                                <span class="star" data-rating="5">★</span>
                            </div>
                            <input type="hidden" id="bookRating" value="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Reseña</label>
                            <textarea class="form-textarea" id="bookReview" required></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Portada</label>
                            <input type="file" class="form-input" accept="image/*" id="bookCover">
                        </div>
                        <button type="submit" class="form-submit">${editingItem ? 'Actualizar' : 'Añadir'} Libro</button>
                    `;
                case 'articles':
                    return `
                        <div class="form-group">
                            <label class="form-label">Título</label>
                            <input type="text" class="form-input" id="articleTitle" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Contenido</label>
                            <textarea class="form-textarea" id="articleContent" style="min-height: 200px;" required></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Archivo Markdown (.md)</label>
                            <input type="file" class="form-input" accept=".md" id="articleMarkdown" onchange="loadMarkdownFile(event)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Imagen de portada</label>
                            <input type="file" class="form-input" accept="image/*" id="articleImage">
                        </div>
                        <button type="submit" class="form-submit">${editingItem ? 'Actualizar' : 'Publicar'} Artículo</button>
                    `;
                case 'media':
                    return `
                        <div class="form-group">
                            <label class="form-label">Seleccionar archivos</label>
                            <input type="file" class="form-input" accept="image/*,video/*" id="mediaFiles" multiple required>
                            <p style="margin-top: 0.5rem; color: var(--text-secondary); font-size: 0.875rem;">
                                Puedes seleccionar múltiples archivos o arrastrarlos a la página
                            </p>
                        </div>
                        <button type="submit" class="form-submit">Subir Archivos</button>
                    `;
            }
        }

        // Form submission
        document.getElementById('modalForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (isUploading) return; // Prevent double submission
            
            const submitButton = e.target.querySelector('.form-submit');
            submitButton.disabled = true;
            submitButton.classList.add('loading');
            submitButton.textContent = 'Guardando...';
            isUploading = true;
            
            try {
                switch(currentSection) {
                    case 'music':
                        await addPlaylist();
                        break;
                    case 'movies':
                        await addMovie();
                        break;
                    case 'books':
                        await addBook();
                        break;
                    case 'articles':
                        await addArticle();
                        break;
                    case 'media':
                        await addMedia();
                        break;
                }
                
                showUploadStatus('Guardado exitosamente', 'success');
                closeModal();
            } catch (error) {
                console.error('Error:', error);
                showUploadStatus('Error al guardar', 'error');
                submitButton.disabled = false;
                submitButton.classList.remove('loading');
                submitButton.textContent = submitButton.textContent.replace('Guardando...', editingItem ? 'Actualizar' : 'Añadir');
                isUploading = false;
            }
        });

        // Helper functions
        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function loadMarkdownFile(event) {
            const file = event.target.files[0];
            if (file && file.name.endsWith('.md')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('articleContent').value = e.target.result;
                };
                reader.readAsText(file);
            }
        }

        function parseMarkdown(markdown) {
            let html = markdown;
            html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
            html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');
            html = html.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/\*([^*]+)\*/g, '<em>$1</em>');
            html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
            html = html.replace(/```([^`]+)```/g, '<pre><code>$1</code></pre>');
            html = html.replace(/`([^`]+)`/g, '<code>$1</code>');
            html = html.replace(/\n\n/g, '</p><p>');
            html = '<p>' + html + '</p>';
            return html;
        }

        // Supabase CRUD operations
        async function loadAllData(userId = null) {
            try {
                // Si no se especifica userId, cargar todo (compatibilidad)
                const userFilter = userId ? userId : (viewingUserId || null);
                
                // Load playlists
                let playlistsQuery = supabaseClient.from('playlists').select('*').order('created_at', { ascending: false });
                if (userFilter) playlistsQuery = playlistsQuery.eq('user_id', userFilter);
                const { data: playlists } = await playlistsQuery;
                data.playlists = playlists || [];

                // Load movies
                let moviesQuery = supabaseClient.from('movies').select('*').order('created_at', { ascending: false });
                if (userFilter) moviesQuery = moviesQuery.eq('user_id', userFilter);
                const { data: movies } = await moviesQuery;
                data.movies = movies || [];

                // Load books
                let booksQuery = supabaseClient.from('books').select('*').order('created_at', { ascending: false });
                if (userFilter) booksQuery = booksQuery.eq('user_id', userFilter);
                const { data: books } = await booksQuery;
                data.books = books || [];

                // Load articles
                let articlesQuery = supabaseClient.from('articles').select('*').order('created_at', { ascending: false });
                if (userFilter) articlesQuery = articlesQuery.eq('user_id', userFilter);
                const { data: articles } = await articlesQuery;
                data.articles = articles || [];

                // Load posts
                let postsQuery = supabaseClient.from('posts').select('*').order('created_at', { ascending: false });
                if (userFilter) postsQuery = postsQuery.eq('user_id', userFilter);
                const { data: posts } = await postsQuery;
                data.posts = posts || [];

                // Load media
                let mediaQuery = supabaseClient.from('media').select('*').order('created_at', { ascending: false });
                if (userFilter) mediaQuery = mediaQuery.eq('user_id', userFilter);
                const { data: media } = await mediaQuery;
                data.media = media || [];
                
                // Si estamos viendo un perfil específico, cargar info del usuario
                if (userFilter && userFilter !== currentUser?.id) {
                    const { data: profile } = await supabaseClient
                        .from('profiles')
                        .select('*')
                        .eq('id', userFilter)
                        .single();
                    
                    if (profile) {
                        viewingUserProfile = profile;
                        updateProfileHeader();
                    }
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        function renderAllSections() {
            renderMusic();
            renderMovies();
            renderBooks();
            renderArticles();
            renderPosts();
            renderMedia();
        }

        // Modified add functions with Supabase
        async function addPlaylist() {
            const url = document.getElementById('playlistUrl').value;
            const name = document.getElementById('playlistName').value;
            
            const playlist = {
                name: name,
                url: url,
                type: url.includes('youtube') ? 'YouTube' : 'Spotify',
                user_id: currentUser?.id || null
            };
            
            if (playlist.type === 'YouTube') {
                const videoMatch = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/);
                const playlistMatch = url.match(/list=([^&\n?#]+)/);
                
                if (videoMatch) {
                    playlist.videoid = videoMatch[1];
                } else if (playlistMatch) {
                    playlist.playlistid = playlistMatch[1];
                }
            }
            
            try {
                if (editingItem) {
                    const { error } = await supabaseClient
                        .from('playlists')
                        .update(playlist)
                        .eq('id', editingItem.id);
                    if (error) throw error;
                } else {
                    const { error } = await supabaseClient
                        .from('playlists')
                        .insert([playlist]);
                    if (error) throw error;
                }
                await loadAllData();
                renderMusic();
            } catch (error) {
                console.error('Error saving playlist:', error);
                throw error;
            }
        }

        async function addMovie() {
            const posterFile = document.getElementById('moviePoster').files[0];
            let posterUrl = editingItem ? editingItem.poster : '';
            
            if (posterFile) {
                // Validar archivo
                const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
                if (!allowedTypes.includes(posterFile.type)) {
                    showUploadStatus('Tipo de archivo no permitido. Solo imágenes JPEG, PNG, GIF o WebP.', 'error');
                    throw new Error('Invalid file type');
                }
                posterUrl = await uploadFile(posterFile, 'movies');
            }
            
            const movie = {
                title: document.getElementById('movieTitle').value,
                director: document.getElementById('movieDirector').value,
                year: parseInt(document.getElementById('movieYear').value),
                rating: parseInt(document.getElementById('movieRating').value) || 0,
                review: document.getElementById('movieReview').value,
                poster: posterUrl || null,
                user_id: getCurrentUserId()
            };
            
            try {
                if (editingItem) {
                    const { error } = await supabaseClient
                        .from('movies')
                        .update(movie)
                        .eq('id', editingItem.id);
                    if (error) throw error;
                } else {
                    const { error } = await supabaseClient
                        .from('movies')
                        .insert([movie]);
                    if (error) throw error;
                }
                await loadAllData();
                renderMovies();
            } catch (error) {
                console.error('Error saving movie:', error);
                throw error;
            }
        }

        async function addBook() {
            const coverFile = document.getElementById('bookCover').files[0];
            let coverUrl = editingItem ? editingItem.cover : '';
            
            if (coverFile) {
                // Validar archivo
                const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
                if (!allowedTypes.includes(coverFile.type)) {
                    showUploadStatus('Tipo de archivo no permitido. Solo imágenes JPEG, PNG, GIF o WebP.', 'error');
                    throw new Error('Invalid file type');
                }
                coverUrl = await uploadFile(coverFile, 'books');
            }
            
            const book = {
                title: document.getElementById('bookTitle').value,
                author: document.getElementById('bookAuthor').value,
                rating: parseInt(document.getElementById('bookRating').value) || 0,
                review: document.getElementById('bookReview').value,
                cover: coverUrl || null,
                user_id: getCurrentUserId()
            };
            
            try {
                if (editingItem) {
                    const { error } = await supabaseClient
                        .from('books')
                        .update(book)
                        .eq('id', editingItem.id);
                    if (error) throw error;
                } else {
                    const { error } = await supabaseClient
                        .from('books')
                        .insert([book]);
                    if (error) throw error;
                }
                await loadAllData();
                renderBooks();
            } catch (error) {
                console.error('Error saving book:', error);
                throw error;
            }
        }

        async function addArticle() {
            const imageFile = document.getElementById('articleImage').files[0];
            let imageUrl = editingItem ? editingItem.image : '';
            
            if (imageFile) {
                // Validar archivo
                const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
                if (!allowedTypes.includes(imageFile.type)) {
                    showUploadStatus('Tipo de archivo no permitido. Solo imágenes JPEG, PNG, GIF o WebP.', 'error');
                    throw new Error('Invalid file type');
                }
                imageUrl = await uploadFile(imageFile, 'articles');
            }
            
            const article = {
                title: document.getElementById('articleTitle').value,
                content: document.getElementById('articleContent').value,
                image: imageUrl || null,
                user_id: getCurrentUserId()
            };
            
            try {
                if (editingItem) {
                    const { error } = await supabaseClient
                        .from('articles')
                        .update(article)
                        .eq('id', editingItem.id);
                    if (error) throw error;
                } else {
                    const { error } = await supabaseClient
                        .from('articles')
                        .insert([article]);
                    if (error) throw error;
                }
                await loadAllData();
                renderArticles();
            } catch (error) {
                console.error('Error saving article:', error);
                throw error;
            }
        }

        async function addMedia() {
            const files = document.getElementById('mediaFiles').files;
            const allowedImages = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
            const allowedVideos = ['video/mp4', 'video/webm'];
            
            for(let file of files) {
                // Validar tipo de archivo
                if (![...allowedImages, ...allowedVideos].includes(file.type)) {
                    showUploadStatus(`Archivo ${file.name} no permitido. Solo imágenes y videos MP4/WebM.`, 'error');
                    continue;
                }
                
                const url = await uploadFile(file, 'gallery');
                if (url) {
                    const mediaItem = {
                        url: url,
                        name: file.name,
                        type: file.type.startsWith('video/') ? 'video' : 'image',
                        user_id: getCurrentUserId()
                    };
                    
                    try {
                        const { error } = await supabaseClient
                            .from('media')
                            .insert([mediaItem]);
                        if (error) throw error;
                    } catch (error) {
                        console.error('Error saving media:', error);
                        throw error;
                    }
                }
            }
            
            await loadAllData();
            renderMedia();
        }

        async function createPost() {
            const content = document.getElementById('postContent').value;
            const mediaFile = document.getElementById('postMedia').files[0];
            
            if(!content && !mediaFile) return;
            
            // Disable button to prevent double posting
            const postButton = document.getElementById('postButton');
            postButton.disabled = true;
            postButton.textContent = 'Publicando...';
            
            try {
                const post = {
                    content: content || '',
                    media: null,
                    media_type: null,
                    user_id: getCurrentUserId()
                };
                
                if (mediaFile) {
                    // Validar tipo de archivo
                    const allowedImages = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
                    const allowedVideos = ['video/mp4', 'video/webm'];
                    
                    if (![...allowedImages, ...allowedVideos].includes(mediaFile.type)) {
                        showUploadStatus('Tipo de archivo no permitido', 'error');
                        throw new Error('Invalid file type');
                    }
                    
                    post.media = await uploadFile(mediaFile, 'posts');
                    post.media_type = mediaFile.type.startsWith('video/') ? 'video' : 'image';
                }
                
                const { error } = await supabaseClient
                    .from('posts')
                    .insert([post]);
                if (error) throw error;
                
                await loadAllData();
                renderPosts();
                document.getElementById('postContent').value = '';
                document.getElementById('postMedia').value = '';
                showUploadStatus('Post publicado', 'success');
            } catch (error) {
                console.error('Error creating post:', error);
                showUploadStatus('Error al publicar', 'error');
            } finally {
                postButton.disabled = false;
                postButton.textContent = 'Postear';
                updatePostButton();
            }
        }

        // Upload file to Supabase Storage with better error handling
        async function uploadFile(file, bucket) {
            // Validate file size (max 50MB)
            const maxSize = 50 * 1024 * 1024; // 50MB
            if (file.size > maxSize) {
                showUploadStatus('El archivo es demasiado grande (máx. 50MB)', 'error');
                throw new Error('File too large');
            }
            
            const fileExt = file.name.split('.').pop().toLowerCase();
            const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;
            
            try {
                // Debug: Log attempt
                console.log('Attempting to upload to bucket:', bucket);
                console.log('File name:', fileName);
                console.log('File size:', file.size);
                
                const { data, error } = await supabaseClient.storage
                    .from(bucket)
                    .upload(fileName, file, {
                        cacheControl: '3600',
                        upsert: false
                    });
                
                if (error) {
                    console.error('Upload error details:', error);
                    
                    // Provide specific error messages
                    if (error.statusCode === '404' || error.message?.includes('not found')) {
                        showUploadStatus(`El bucket '${bucket}' no existe. Créalo en Supabase Dashboard → Storage`, 'error');
                    } else if (error.statusCode === '401') {
                        showUploadStatus('Error de autenticación. Verifica tu API key', 'error');
                    } else if (error.statusCode === '413') {
                        showUploadStatus('Archivo demasiado grande', 'error');
                    } else if (error.message?.includes('row-level security')) {
                        showUploadStatus('Error de permisos. Las políticas RLS necesitan configuración', 'error');
                    } else {
                        showUploadStatus(`Error: ${error.message}`, 'error');
                    }
                    throw error;
                }
                
                const { data: { publicUrl } } = supabaseClient.storage
                    .from(bucket)
                    .getPublicUrl(fileName);
                
                console.log('Upload successful:', publicUrl);
                return publicUrl;
            } catch (error) {
                console.error('Upload error:', error);
                throw error;
            }
        }

        // Delete function with Supabase - Fixed authentication check
        async function deleteItem(section, id) {
            if (!isAuthenticated && !currentUser) {
                document.getElementById('passwordModal').classList.add('active');
                document.getElementById('passwordInput').focus();
                // Save context to delete after authentication
                window.pendingDelete = { section, id };
                return;
            }
            
            if (confirm('¿Estás seguro de que quieres eliminar este elemento?')) {
                try {
                    const table = section === 'playlists' ? 'playlists' : section;
                    const { error } = await supabaseClient
                        .from(table)
                        .delete()
                        .eq('id', id);
                    
                    if (error) throw error;
                    
                    await loadAllData();
                    renderSection(section);
                    showUploadStatus('Eliminado exitosamente', 'success');
                } catch (error) {
                    console.error('Error deleting item:', error);
                    showUploadStatus('Error al eliminar', 'error');
                }
            }
        }

        function renderSection(section) {
            switch(section) {
                case 'playlists':
                    renderMusic();
                    break;
                case 'movies':
                    renderMovies();
                    break;
                case 'books':
                    renderBooks();
                    break;
                case 'articles':
                    renderArticles();
                    break;
                case 'posts':
                    renderPosts();
                    break;
                case 'media':
                    renderMedia();
                    break;
            }
        }

        // Render functions
        function renderMusic() {
            const grid = document.getElementById('musicGrid');
            grid.innerHTML = data.playlists.map(playlist => `
                <div class="playlist-card">
                    ${(isAuthenticated || currentUser) && isOwnerView ? `
                    <div class="action-buttons">
                        <button class="action-btn" onclick='openModal(${JSON.stringify(playlist)})'>Editar</button>
                        <button class="action-btn delete" onclick="deleteItem('playlists', ${playlist.id})">Eliminar</button>
                    </div>
                    ` : ''}
                    <h3>${playlist.name}</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">${playlist.type}</p>
                    ${playlist.videoid ? `
                        <div class="playlist-embed">
                            <iframe width="100%" height="200" 
                                src="https://www.youtube.com/embed/${playlist.videoid}" 
                                frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                            </iframe>
                        </div>
                    ` : playlist.playlistid ? `
                        <div class="playlist-embed">
                            <iframe width="100%" height="200" 
                                src="https://www.youtube.com/embed/videoseries?list=${playlist.playlistid}" 
                                frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                            </iframe>
                        </div>
                    ` : `<a href="${playlist.url}" target="_blank" style="color: var(--accent);">Abrir en ${playlist.type} →</a>`}
                </div>
            `).join('');
        }

        function renderMovies() {
            const grid = document.getElementById('moviesGrid');
            grid.innerHTML = data.movies.map(movie => `
                <div class="content-card" onclick="openMovie(${movie.id})">
                    ${(isAuthenticated || currentUser) && isOwnerView ? `
                    <div class="action-buttons">
                        <button class="action-btn" onclick="event.stopPropagation(); openModal(${JSON.stringify(movie)})">Editar</button>
                        <button class="action-btn delete" onclick="event.stopPropagation(); deleteItem('movies', ${movie.id})">Eliminar</button>
                    </div>
                    ` : ''}
                    ${movie.poster ? `<img src="${movie.poster}" alt="${movie.title}" class="card-image">` : '<div class="card-image" style="background: var(--card-bg); display: flex; align-items: center; justify-content: center; font-size: 3rem;">🎬</div>'}
                    <div class="card-body">
                        <h3 class="card-title">${movie.title}</h3>
                        <p class="card-subtitle">${movie.director} • ${movie.year}</p>
                        <div class="star-rating">
                            ${renderStars(movie.rating)}
                        </div>
                        <p class="card-description">${movie.review.substring(0, 150)}...</p>
                    </div>
                </div>
            `).join('');
        }

        function renderBooks() {
            const grid = document.getElementById('booksGrid');
            grid.innerHTML = data.books.map(book => `
                <div class="content-card" onclick="openBook(${book.id})">
                    ${(isAuthenticated || currentUser) && isOwnerView ? `
                    <div class="action-buttons">
                        <button class="action-btn" onclick="event.stopPropagation(); openModal(${JSON.stringify(book)})">Editar</button>
                        <button class="action-btn delete" onclick="event.stopPropagation(); deleteItem('books', ${book.id})">Eliminar</button>
                    </div>
                    ` : ''}
                    ${book.cover ? `<img src="${book.cover}" alt="${book.title}" class="card-image">` : '<div class="card-image" style="background: var(--card-bg); display: flex; align-items: center; justify-content: center; font-size: 3rem;">📚</div>'}
                    <div class="card-body">
                        <h3 class="card-title">${book.title}</h3>
                        <p class="card-subtitle">${book.author}</p>
                        <div class="star-rating">
                            ${renderStars(book.rating)}
                        </div>
                        <p class="card-description">${book.review.substring(0, 150)}...</p>
                    </div>
                </div>
            `).join('');
        }

        function renderStars(rating, large = false) {
            let stars = '';
            const size = large ? '1.5rem' : '1rem';
            for (let i = 1; i <= 5; i++) {
                stars += `<span class="star ${i <= rating ? 'filled' : ''}" style="font-size: ${size};">★</span>`;
            }
            return stars;
        }

        function renderArticles() {
            const grid = document.getElementById('articlesGrid');
            grid.innerHTML = data.articles.map(article => `
                <div class="content-card" onclick="openArticle(${article.id})">
                    ${(isAuthenticated || currentUser) && isOwnerView ? `
                    <div class="action-buttons">
                        <button class="action-btn" onclick="event.stopPropagation(); openModal(${JSON.stringify(article)})">Editar</button>
                        <button class="action-btn delete" onclick="event.stopPropagation(); deleteItem('articles', ${article.id})">Eliminar</button>
                    </div>
                    ` : ''}
                    ${article.image ? `<img src="${article.image}" alt="${article.title}" class="card-image">` : '<div class="card-image" style="background: var(--card-bg); display: flex; align-items: center; justify-content: center; font-size: 3rem;">📝</div>'}
                    <div class="card-body">
                        <h3 class="card-title">${article.title}</h3>
                        <p class="card-subtitle">${formatDate(article.created_at)}</p>
                        <p class="card-description">${article.content.substring(0, 150)}...</p>
                    </div>
                </div>
            `).join('');
        }

        function renderPosts() {
            const feed = document.getElementById('postsFeed');
            
            // Actualizar avatar del composer si hay usuario
            if (currentUser && currentUser.profile) {
                const composerAvatar = document.getElementById('postComposerAvatar');
                if (composerAvatar) {
                    const initials = (currentUser.profile.full_name || 'Usuario')
                        .split(' ')
                        .map(n => n[0])
                        .join('')
                        .toUpperCase()
                        .slice(0, 2);
                    composerAvatar.textContent = initials;
                }
            }
            
            feed.innerHTML = data.posts.map((post, index) => {
                // Obtener información del usuario correcto
                let userInitials = 'U';
                let userName = 'Usuario';
                let userUsername = '@usuario';
                
                // Si estamos viendo un perfil específico
                if (viewingUserProfile && !isOwnerView) {
                    userInitials = viewingUserProfile.full_name
                        .split(' ')
                        .map(n => n[0])
                        .join('')
                        .toUpperCase()
                        .slice(0, 2);
                    userName = viewingUserProfile.full_name;
                    userUsername = `@${viewingUserProfile.username}`;
                } 
                // Si es nuestro propio perfil y hay usuario logueado
                else if (currentUser && currentUser.profile && isOwnerView) {
                    userInitials = currentUser.profile.full_name
                        .split(' ')
                        .map(n => n[0])
                        .join('')
                        .toUpperCase()
                        .slice(0, 2);
                    userName = currentUser.profile.full_name;
                    userUsername = `@${currentUser.profile.username}`;
                }
                
                return `
                    <div class="post">
                        <div class="post-wrapper">
                            <div class="post-avatar">${userInitials}</div>
                            <div class="post-main">
                                <div class="post-header">
                                    <div class="post-author-line">
                                        <span class="post-author">${userName}</span>
                                        <span class="post-username">${userUsername}</span>
                                        <span class="post-date">${post.created_at ? formatDate(post.created_at) : ''}</span>
                                    </div>
                                    ${(isAuthenticated || currentUser) && isOwnerView ? `
                                    <button class="post-menu-button" onclick="togglePostMenu(${post.id})">⋯</button>
                                    ` : ''}
                                </div>
                                ${post.content ? `<div class="post-content">${post.content}</div>` : ''}
                                ${post.media ? 
                                    `<div class="post-media">
                                        ${post.media_type === 'video' ?
                                            `<video src="${post.media}" controls></video>` :
                                            `<img src="${post.media}" alt="Post media" onclick="openLightbox('${post.media}', 'image')">`
                                        }
                                    </div>` 
                                    : ''
                                }
                            </div>
                        </div>
                        ${(isAuthenticated || currentUser) && isOwnerView ? `
                        <div class="post-menu" style="display: none;">
                            <div class="post-menu-dropdown" id="menu-${post.id}">
                                <button class="post-menu-item delete" onclick="deleteItem('posts', ${post.id})">Eliminar</button>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // Toggle post menu
        function togglePostMenu(postId) {
            const button = event.currentTarget;
            const post = button.closest('.post');
            const menu = post.querySelector('.post-menu');
            const dropdown = post.querySelector('.post-menu-dropdown');
            
            // Close all other menus
            document.querySelectorAll('.post-menu').forEach(m => {
                if (m !== menu) {
                    m.style.display = 'none';
                }
            });
            
            if (menu.style.display === 'none' || !menu.style.display) {
                // Position the menu
                const rect = button.getBoundingClientRect();
                const postRect = post.getBoundingClientRect();
                menu.style.position = 'absolute';
                menu.style.top = (rect.top - postRect.top) + 'px';
                menu.style.right = '1rem';
                menu.style.display = 'block';
                
                // Show with animation
                setTimeout(() => {
                    menu.classList.add('active');
                }, 10);
            } else {
                menu.classList.remove('active');
                setTimeout(() => {
                    menu.style.display = 'none';
                }, 200);
            }
        }

        // Close menus when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.post-menu-button')) {
                document.querySelectorAll('.post-menu').forEach(menu => {
                    menu.classList.remove('active');
                    setTimeout(() => {
                        menu.style.display = 'none';
                    }, 200);
                });
            }
        });

        // Format date to relative time - Fixed for real time
        function formatDate(dateString) {
            if (!dateString) return '';
            
            // Parse the date string correctly from Supabase
            const date = new Date(dateString);
            const now = new Date();
            
            // Check if date is valid
            if (isNaN(date.getTime())) {
                return '';
            }
            
            const diff = now.getTime() - date.getTime();
            
            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (seconds < 60) return 'ahora';
            if (minutes < 60) return `${minutes}m`;
            if (hours < 24) return `${hours}h`;
            if (days < 7) return `${days}d`;
            
            return date.toLocaleDateString('es-ES', { 
                day: 'numeric',
                month: 'short',
                year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined
            });
        }

        // Update profile header
        async function updateProfileHeader() {
            const heroTitle = document.querySelector('.hero-title');
            const heroSubtitle = document.getElementById('heroSubtitle');
            const profileInfo = document.getElementById('profileInfo');
            
            if (viewingUserProfile) {
                // Viendo perfil de otro usuario
                const initials = viewingUserProfile.full_name
                    .split(' ')
                    .map(word => word[0])
                    .join('')
                    .toUpperCase()
                    .slice(0, 3);
                
                heroTitle.innerHTML = initials.split('').map((letter, i) => 
                    `<span style="--i: ${i}">${letter}</span>`
                ).join('');
                
                heroSubtitle.textContent = viewingUserProfile.full_name;
                isOwnerView = false;
                
                // Obtener contadores
                const counts = await getFollowCounts(viewingUserId);
                const isFollowing = followingUsers.includes(viewingUserId);
                
                profileInfo.innerHTML = `
                    <div class="follow-stats">
                        <div class="stat-item" onclick="showFollowersList('${viewingUserId}')">
                            <div class="stat-count">${counts.followers}</div>
                            <div class="stat-label">Seguidores</div>
                        </div>
                        <div class="stat-item" onclick="showFollowingList('${viewingUserId}')">
                            <div class="stat-count">${counts.following}</div>
                            <div class="stat-label">Siguiendo</div>
                        </div>
                    </div>
                    ${currentUser && viewingUserId !== currentUser.id ? `
                        <button id="followButton" class="${isFollowing ? 'following' : 'not-following'}" onclick="toggleFollow('${viewingUserId}')" style="
                            padding: 0.75rem 2rem;
                            background: ${isFollowing ? 'transparent' : 'var(--gradient-accent)'};
                            border: ${isFollowing ? '1px solid var(--accent)' : 'none'};
                            border-radius: 9999px;
                            color: ${isFollowing ? 'var(--accent)' : 'white'};
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.2s;
                        "></button>
                    ` : ''}
                `;
                
                // Agregar botón para volver a mi perfil
                if (!document.getElementById('backToMyProfile')) {
                    const hero = document.querySelector('.hero');
                    const backButton = document.createElement('button');
                    backButton.id = 'backToMyProfile';
                    backButton.innerHTML = '← Volver a mi perfil';
                    backButton.style.cssText = `
                        position: absolute;
                        top: 2rem;
                        left: 2rem;
                        background: var(--gradient-accent);
                        border: none;
                        padding: 0.5rem 1rem;
                        border-radius: 8px;
                        color: white;
                        cursor: pointer;
                        font-weight: 600;
                    `;
                    backButton.onclick = () => navigateToProfile(currentUser?.id);
                    hero.appendChild(backButton);
                }
            } else {
                // Viendo nuestro propio perfil
                const backButton = document.getElementById('backToMyProfile');
                if (backButton) backButton.remove();
                
                if (currentUser && currentUser.profile) {
                    // USUARIO LOGUEADO - MOSTRAR SU INFORMACIÓN
                    const customInitials = currentUser.profile.custom_initials;
                    let displayInitials;
                    
                    if (customInitials && customInitials.trim() !== '') {
                        // Usar iniciales personalizadas
                        displayInitials = customInitials.toUpperCase();
                    } else {
                        // Usar iniciales del nombre
                        displayInitials = currentUser.profile.full_name
                            .split(' ')
                            .map(word => word[0])
                            .join('')
                            .toUpperCase()
                            .slice(0, 3);
                    }
                    
                    heroTitle.innerHTML = displayInitials.split('').map((letter, i) => 
                        `<span style="--i: ${i}">${letter}</span>`
                    ).join('');
                    
                    heroSubtitle.textContent = currentUser.profile.full_name;
                    
                    // Mostrar contadores para perfil propio
                    const counts = await getFollowCounts(currentUser.id);
                    
                    profileInfo.innerHTML = `
                        <div class="follow-stats">
                            <div class="stat-item" onclick="showFollowersList()">
                                <div class="stat-count">${counts.followers}</div>
                                <div class="stat-label">Seguidores</div>
                            </div>
                            <div class="stat-item" onclick="showFollowingList()">
                                <div class="stat-count">${counts.following}</div>
                                <div class="stat-label">Siguiendo</div>
                            </div>
                        </div>
                        <button class="edit-profile-btn" onclick="openEditProfileModal()">
                            <span>✏️</span>
                            <span>Editar Perfil</span>
                        </button>
                    `;
                } else {
                    // NO HAY USUARIO LOGUEADO - MOSTRAR PÁGINA DE BIENVENIDA
                    heroTitle.innerHTML = `
                        <span style="--i: 0">👋</span>
                    `;
                    heroSubtitle.textContent = 'Bienvenido';
                    profileInfo.innerHTML = `
                        <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                            Inicia sesión o regístrate para crear tu espacio digital
                        </p>
                        <button onclick="openAuthModal()" style="
                            padding: 0.75rem 2rem;
                            background: var(--gradient-accent);
                            border: none;
                            border-radius: 9999px;
                            color: white;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.2s;
                        ">
                            Comenzar
                        </button>
                    `;
                }
                isOwnerView = true;
            }
            
            // Actualizar visibilidad de botones de acción
            updateActionButtonsVisibility();
        }

        // Update action buttons visibility
        function updateActionButtonsVisibility() {
            console.log('Actualizando visibilidad de botones. isOwnerView:', isOwnerView, 'currentUser:', currentUser);
            
            // Solo mostrar botones de edición si es nuestro perfil
            if (isOwnerView && (isAuthenticated || currentUser)) {
                showActionButtons();
                // Mostrar el composer de posts
                const postComposer = document.getElementById('postComposer');
                if (postComposer) {
                    postComposer.style.display = 'block';
                }
            } else {
                // Ocultar botones de acción si estamos viendo otro perfil
                document.querySelectorAll('.action-buttons').forEach(btn => {
                    btn.style.display = 'none';
                });
                document.querySelector('.fab').classList.remove('visible');
                const postComposer = document.getElementById('postComposer');
                if (postComposer) {
                    postComposer.style.display = 'none';
                }
            }
        }

        document.getElementById('postContent').addEventListener('input', updatePostButton);
        document.getElementById('postMedia').addEventListener('change', updatePostButton);

        // Update post button state
        function updatePostButton() {
            const content = document.getElementById('postContent').value;
            const hasMedia = document.getElementById('postMedia').files.length > 0;
            const button = document.getElementById('postButton');
            button.disabled = !content.trim() && !hasMedia;
        }

        function renderMedia() {
            const grid = document.getElementById('mediaGrid');
            grid.innerHTML = data.media.map(media => `
                <div class="media-item" onclick="openLightbox('${media.url}', '${media.type}')">
                    ${(isAuthenticated || currentUser) && isOwnerView ? `
                    <div class="action-buttons">
                        <button class="action-btn delete" onclick="event.stopPropagation(); deleteItem('media', ${media.id})">Eliminar</button>
                    </div>
                    ` : ''}
                    ${media.type === 'video' ? 
                        `<video src="${media.url}"></video>` :
                        `<img src="${media.url}" alt="${media.name}">`
                    }
                    <div class="media-overlay">
                        <span>${media.name}</span>
                    </div>
                </div>
            `).join('');
        }

        // Lightbox
        function openLightbox(url, type) {
            const lightbox = document.getElementById('lightbox');
            const content = document.getElementById('lightboxMedia');
            
            if (type === 'video') {
                content.innerHTML = `<video src="${url}" controls autoplay style="max-width: 100%; max-height: 90vh; border-radius: 8px;"></video>`;
            } else {
                content.innerHTML = `<img src="${url}" style="max-width: 100%; max-height: 90vh; border-radius: 8px;">`;
            }
            
            lightbox.classList.add('active');
        }

        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
            document.getElementById('lightboxMedia').innerHTML = '';
        }

        // Article viewer
        function openArticle(id) {
            const article = data.articles.find(a => a.id === id);
            if (article) {
                const lightbox = document.getElementById('lightbox');
                const content = document.getElementById('lightboxMedia');
                
                content.innerHTML = `
                    <div style="background: var(--bg-secondary); padding: 3rem; border-radius: 16px; max-width: 800px; max-height: 90vh; overflow-y: auto;">
                        <h1 style="margin-bottom: 1rem;">${article.title}</h1>
                        <p style="color: var(--text-secondary); margin-bottom: 2rem;">${formatDate(article.created_at)}</p>
                        <div style="line-height: 1.8;">${parseMarkdown(article.content)}</div>
                    </div>
                `;
                
                lightbox.classList.add('active');
            }
        }

        // Movie viewer
        function openMovie(id) {
            const movie = data.movies.find(m => m.id === id);
            if (movie) {
                const lightbox = document.getElementById('lightbox');
                const content = document.getElementById('lightboxMedia');
                
                content.innerHTML = `
                    <div style="background: var(--bg-secondary); padding: 3rem; border-radius: 16px; max-width: 800px; max-height: 90vh; overflow-y: auto; display: flex; gap: 2rem;">
                        ${movie.poster ? `
                        <div style="flex-shrink: 0;">
                            <img src="${movie.poster}" alt="${movie.title}" style="width: 300px; border-radius: 12px;">
                        </div>
                        ` : ''}
                        <div style="flex: 1;">
                            <h1 style="margin-bottom: 0.5rem; font-size: 2.5rem;">${movie.title}</h1>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 1.125rem;">
                                Dirigida por ${movie.director} • ${movie.year}
                            </p>
                            <div style="margin-bottom: 2rem;">
                                ${renderStars(movie.rating, true)}
                            </div>
                            <h3 style="margin-bottom: 1rem; color: var(--accent);">Reseña</h3>
                            <div style="line-height: 1.8; font-size: 1.125rem; white-space: pre-wrap;">${movie.review}</div>
                        </div>
                    </div>
                `;
                
                lightbox.classList.add('active');
            }
        }

        // Book viewer
        function openBook(id) {
            const book = data.books.find(b => b.id === id);
            if (book) {
                const lightbox = document.getElementById('lightbox');
                const content = document.getElementById('lightboxMedia');
                
                content.innerHTML = `
                    <div style="background: var(--bg-secondary); padding: 3rem; border-radius: 16px; max-width: 800px; max-height: 90vh; overflow-y: auto; display: flex; gap: 2rem;">
                        ${book.cover ? `
                        <div style="flex-shrink: 0;">
                            <img src="${book.cover}" alt="${book.title}" style="width: 250px; border-radius: 12px;">
                        </div>
                        ` : ''}
                        <div style="flex: 1;">
                            <h1 style="margin-bottom: 0.5rem; font-size: 2.5rem;">${book.title}</h1>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 1.125rem;">
                                Por ${book.author}
                            </p>
                            <div style="margin-bottom: 2rem;">
                                ${renderStars(book.rating, true)}
                            </div>
                            <h3 style="margin-bottom: 1rem; color: var(--accent);">Reseña</h3>
                            <div style="line-height: 1.8; font-size: 1.125rem; white-space: pre-wrap;">${book.review}</div>
                        </div>
                    </div>
                `;
                
                lightbox.classList.add('active');
            }
        }

        // Auth button handler
        async function handleAuthClick() {
            if (currentUser) {
                // Si hay usuario, mostrar opciones (por ahora solo logout)
                if (confirm('¿Deseas cerrar sesión?')) {
                    await supabaseClient.auth.signOut();
                    currentUser = null;
                    isAuthenticated = false;
                    location.reload();
                }
            } else {
                // Si no hay usuario, abrir modal de login
                openAuthModal();
            }
        }

        // Actualizar UI del botón de auth cuando cambie el estado
        supabaseClient.auth.onAuthStateChange((event, session) => {
            if (session) {
                document.getElementById('authIcon').textContent = '👤';
                document.getElementById('authText').textContent = session.user.email.split('@')[0];
            } else {
                document.getElementById('authIcon').textContent = '👤';
                document.getElementById('authText').textContent = 'Iniciar Sesión';
            }
        });

        // Drag and drop for media
        document.addEventListener('dragover', (e) => {
            if (currentSection === 'media' && (isAuthenticated || currentUser) && isOwnerView) {
                e.preventDefault();
            }
        });

        document.addEventListener('drop', async (e) => {
            if (currentSection === 'media' && (isAuthenticated || currentUser) && isOwnerView) {
                e.preventDefault();
                
                const files = Array.from(e.dataTransfer.files).filter(file => 
                    file.type.startsWith('image/') || file.type.startsWith('video/')
                );
                
                if (files.length > 0) {
                    showUploadStatus('Subiendo archivos...', 'success');
                    
                    for(let file of files) {
                        try {
                            const url = await uploadFile(file, 'gallery');
                            if (url) {
                                const mediaItem = {
                                    url: url,
                                    name: file.name,
                                    type: file.type.startsWith('video/') ? 'video' : 'image',
                                    user_id: getCurrentUserId()
                                };
                                
                                const { error } = await supabaseClient
                                    .from('media')
                                    .insert([mediaItem]);
                                if (error) throw error;
                            }
                        } catch (error) {
                            console.error('Error uploading file:', error);
                            showUploadStatus(`Error al subir ${file.name}`, 'error');
                        }
                    }
                    
                    await loadAllData();
                    renderMedia();
                    showUploadStatus('Archivos subidos exitosamente', 'success');
                }
            }
        });

        // Feed Global Functions
        let currentFeedTab = 'all';
        let feedData = {
            posts: [],
            movies: [],
            books: [],
            music: [],
            articles: [],
            all: [],
            following: []
        };

        async function loadFeedData() {
            try {
                // Cargar posts con info del usuario
                const { data: posts } = await supabaseClient
                    .from('posts')
                    .select(`
                        *,
                        profiles:user_id (
                            id,
                            username,
                            full_name,
                            avatar_url
                        )
                    `)
                    .order('created_at', { ascending: false })
                    .limit(20);
                
                // Cargar películas con info del usuario
                const { data: movies } = await supabaseClient
                    .from('movies')
                    .select(`
                        *,
                        profiles:user_id (
                            id,
                            username,
                            full_name,
                            avatar_url
                        )
                    `)
                    .order('created_at', { ascending: false })
                    .limit(10);
                
                // Cargar libros con info del usuario
                const { data: books } = await supabaseClient
                    .from('books')
                    .select(`
                        *,
                        profiles:user_id (
                            id,
                            username,
                            full_name,
                            avatar_url
                        )
                    `)
                    .order('created_at', { ascending: false })
                    .limit(10);
                
                // Cargar playlists con info del usuario
                const { data: playlists } = await supabaseClient
                    .from('playlists')
                    .select(`
                        *,
                        profiles:user_id (
                            id,
                            username,
                            full_name,
                            avatar_url
                        )
                    `)
                    .order('created_at', { ascending: false })
                    .limit(10);
                
                // Cargar artículos
                const { data: articles } = await supabaseClient
                    .from('articles')
                    .select(`
                        *,
                        profiles:user_id (
                            id,
                            username,
                            full_name,
                            avatar_url
                        )
                    `)
                    .order('created_at', { ascending: false })
                    .limit(10);
                
                feedData.posts = posts || [];
                feedData.movies = movies || [];
                feedData.books = books || [];
                feedData.music = playlists || [];
                feedData.articles = articles || [];
                
                // Combinar todo para el feed "all"
                feedData.all = [
                    ...feedData.posts.map(p => ({...p, type: 'post'})),
                    ...feedData.movies.map(m => ({...m, type: 'movie'})),
                    ...feedData.books.map(b => ({...b, type: 'book'})),
                    ...feedData.music.map(m => ({...m, type: 'music'})),
                    ...feedData.articles.map(a => ({...a, type: 'article'}))
                ].sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                
                // Cargar feed de usuarios seguidos si está logueado
                if (currentUser && followingUsers.length > 0) {
                    await loadFollowingFeed();
                }
                
                renderFeed();
            } catch (error) {
                console.error('Error loading feed:', error);
            }
        }

        async function loadFollowingFeed() {
            if (!currentUser || followingUsers.length === 0) {
                feedData.following = [];
                return;
            }
            
            try {
                // Cargar contenido solo de usuarios que seguimos
                const [posts, movies, books, playlists, articles] = await Promise.all([
                    supabaseClient
                        .from('posts')
                        .select(`
                            *,
                            profiles:user_id (
                                id,
                                username,
                                full_name,
                                avatar_url
                            )
                        `)
                        .in('user_id', followingUsers)
                        .order('created_at', { ascending: false })
                        .limit(20),
                    
                    supabaseClient
                        .from('movies')
                        .select(`
                            *,
                            profiles:user_id (
                                id,
                                username,
                                full_name,
                                avatar_url
                            )
                        `)
                        .in('user_id', followingUsers)
                        .order('created_at', { ascending: false })
                        .limit(10),
                    
                    supabaseClient
                        .from('books')
                        .select(`
                            *,
                            profiles:user_id (
                                id,
                                username,
                                full_name,
                                avatar_url
                            )
                        `)
                        .in('user_id', followingUsers)
                        .order('created_at', { ascending: false })
                        .limit(10),
                    
                    supabaseClient
                        .from('playlists')
                        .select(`
                            *,
                            profiles:user_id (
                                id,
                                username,
                                full_name,
                                avatar_url
                            )
                        `)
                        .in('user_id', followingUsers)
                        .order('created_at', { ascending: false })
                        .limit(10),
                    
                    supabaseClient
                        .from('articles')
                        .select(`
                            *,
                            profiles:user_id (
                                id,
                                username,
                                full_name,
                                avatar_url
                            )
                        `)
                        .in('user_id', followingUsers)
                        .order('created_at', { ascending: false })
                        .limit(10)
                ]);
                
                // Combinar todo para el feed "following"
                feedData.following = [
                    ...(posts.data || []).map(p => ({...p, type: 'post'})),
                    ...(movies.data || []).map(m => ({...m, type: 'movie'})),
                    ...(books.data || []).map(b => ({...b, type: 'book'})),
                    ...(playlists.data || []).map(m => ({...m, type: 'music'})),
                    ...(articles.data || []).map(a => ({...a, type: 'article'}))
                ].sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                
            } catch (error) {
                console.error('Error loading following feed:', error);
                feedData.following = [];
            }
        }

        function switchFeedTab(tab) {
            currentFeedTab = tab;
            
            // Actualizar estilos de los tabs
            document.querySelectorAll('.feed-tab').forEach(t => {
                t.classList.remove('active');
                t.style.color = 'var(--text-secondary)';
                t.style.borderBottom = 'none';
            });
            
            const activeTab = document.querySelector(`[data-tab="${tab}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
                activeTab.style.color = 'var(--text-primary)';
                activeTab.style.borderBottom = '2px solid var(--accent)';
            }
            
            renderFeed();
        }

        function renderFeed() {
            const feedContent = document.getElementById('feedContent');
            if (!feedContent) return;
            
            let content = '';
            
            if (currentFeedTab === 'all') {
                content = feedData.all.map(item => renderFeedItem(item)).join('');
            } else if (currentFeedTab === 'following') {
                if (!currentUser) {
                    content = '<p style="text-align: center; color: var(--text-secondary); margin-top: 2rem;">Inicia sesión para ver el contenido de usuarios que sigues</p>';
                } else if (followingUsers.length === 0) {
                    content = '<p style="text-align: center; color: var(--text-secondary); margin-top: 2rem;">No sigues a ningún usuario todavía</p>';
                } else if (feedData.following.length === 0) {
                    content = '<p style="text-align: center; color: var(--text-secondary); margin-top: 2rem;">No hay contenido nuevo de los usuarios que sigues</p>';
                } else {
                    content = feedData.following.map(item => renderFeedItem(item)).join('');
                }
            } else if (currentFeedTab === 'posts') {
                content = `<div class="posts-feed">${feedData.posts.map(post => renderFeedPost(post)).join('')}</div>`;
            } else {
                const items = feedData[currentFeedTab] || [];
                content = `<div class="cards-grid">${items.map(item => renderFeedCard(item, currentFeedTab)).join('')}</div>`;
            }
            
            feedContent.innerHTML = content || '<p style="text-align: center; color: var(--text-secondary);">No hay contenido para mostrar</p>';
        }

        function renderFeedItem(item) {
            switch(item.type) {
                case 'post':
                    return `<div class="posts-feed">${renderFeedPost(item)}</div>`;
                case 'movie':
                    return `<div class="feed-item-wrapper" style="margin-bottom: 2rem;">${renderFeedCard(item, 'movie')}</div>`;
                case 'book':
                    return `<div class="feed-item-wrapper" style="margin-bottom: 2rem;">${renderFeedCard(item, 'book')}</div>`;
                case 'music':
                    return `<div class="feed-item-wrapper" style="margin-bottom: 2rem;">${renderFeedCard(item, 'music')}</div>`;
                case 'article':
                    return `<div class="feed-item-wrapper" style="margin-bottom: 2rem;">${renderFeedCard(item, 'article')}</div>`;
                default:
                    return '';
            }
        }

        function renderFeedPost(post) {
            const profile = post.profiles || {};
            const initials = (profile.full_name || 'Usuario')
                .split(' ')
                .map(n => n[0])
                .join('')
                .toUpperCase()
                .slice(0, 2);
            
            return `
                <div class="post" onclick="navigateToProfile('${post.user_id}')">
                    <div class="post-wrapper">
                        <div class="post-avatar">${initials}</div>
                        <div class="post-main">
                            <div class="post-header">
                                <div class="post-author-line">
                                    <span class="post-author">${profile.full_name || 'Usuario'}</span>
                                    <span class="post-username">@${profile.username || 'usuario'}</span>
                                    <span class="post-date">${formatDate(post.created_at)}</span>
                                </div>
                            </div>
                            ${post.content ? `<div class="post-content">${post.content}</div>` : ''}
                            ${post.media ? 
                                `<div class="post-media">
                                    ${post.media_type === 'video' ?
                                        `<video src="${post.media}" controls></video>` :
                                        `<img src="${post.media}" alt="Post media">`
                                    }
                                </div>` 
                                : ''
                            }
                        </div>
                    </div>
                </div>
            `;
        }

        function renderFeedCard(item, type) {
            const profile = item.profiles || {};
            let cardContent = '';
            
            switch(type) {
                case 'movie':
                    cardContent = `
                        <div class="content-card" style="cursor: pointer;" onclick="event.stopPropagation(); openMovie(${item.id})">
                            ${item.poster ? `<img src="${item.poster}" alt="${item.title}" class="card-image">` : '<div class="card-image" style="background: var(--card-bg); display: flex; align-items: center; justify-content: center; font-size: 3rem;">🎬</div>'}
                            <div class="card-body">
                                <h3 class="card-title">${item.title}</h3>
                                <p class="card-subtitle">${item.director} • ${item.year}</p>
                                <div class="star-rating">${renderStars(item.rating)}</div>
                                <div style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid var(--border);">
                                    <p style="font-size: 0.75rem; color: var(--text-secondary); cursor: pointer;" onclick="event.stopPropagation(); navigateToProfile('${item.user_id}')">
                                        Por ${profile.full_name || 'Usuario'}
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'book':
                    cardContent = `
                        <div class="content-card" style="cursor: pointer;" onclick="event.stopPropagation(); openBook(${item.id})">
                            ${item.cover ? `<img src="${item.cover}" alt="${item.title}" class="card-image">` : '<div class="card-image" style="background: var(--card-bg); display: flex; align-items: center; justify-content: center; font-size: 3rem;">📚</div>'}
                            <div class="card-body">
                                <h3 class="card-title">${item.title}</h3>
                                <p class="card-subtitle">${item.author}</p>
                                <div class="star-rating">${renderStars(item.rating)}</div>
                                <div style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid var(--border);">
                                    <p style="font-size: 0.75rem; color: var(--text-secondary); cursor: pointer;" onclick="event.stopPropagation(); navigateToProfile('${item.user_id}')">
                                        Por ${profile.full_name || 'Usuario'}
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'music':
                    cardContent = `
                        <div class="playlist-card">
                            <h3>${item.name}</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem;">${item.type}</p>
                            <div style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid var(--border);">
                                <p style="font-size: 0.75rem; color: var(--text-secondary); cursor: pointer;" onclick="navigateToProfile('${item.user_id}')">
                                    Por ${profile.full_name || 'Usuario'}
                                </p>
                            </div>
                        </div>
                    `;
                    break;
                case 'article':
                    cardContent = `
                        <div class="content-card" style="cursor: pointer;" onclick="event.stopPropagation(); openArticle(${item.id})">
                            ${item.image ? `<img src="${item.image}" alt="${item.title}" class="card-image">` : '<div class="card-image" style="background: var(--card-bg); display: flex; align-items: center; justify-content: center; font-size: 3rem;">📝</div>'}
                            <div class="card-body">
                                <h3 class="card-title">${item.title}</h3>
                                <p class="card-subtitle">${formatDate(item.created_at)}</p>
                                <p class="card-description">${item.content.substring(0, 150)}...</p>
                                <div style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid var(--border);">
                                    <p style="font-size: 0.75rem; color: var(--text-secondary); cursor: pointer;" onclick="event.stopPropagation(); navigateToProfile('${item.user_id}')">
                                        Por ${profile.full_name || 'Usuario'}
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            return cardContent;
        }

        // Navigate to user profile
        async function navigateToProfile(userId) {
            if (!userId) return;
            
            // Si es nuestro propio perfil
            if (userId === currentUser?.id) {
                viewingUserId = null;
                viewingUserProfile = null;
                isOwnerView = true;
            } else {
                // Ver perfil de otro usuario
                viewingUserId = userId;
                isOwnerView = false;
            }
            
            // Cargar datos del usuario específico
            await loadAllData(userId);
            updateProfileHeader();
            
            // Navegar a la sección home
            navigateToSection('home');
        }

        // Edit Profile Functions
        function openEditProfileModal() {
            if (!currentUser || !currentUser.profile) return;
            
            // Prellenar el formulario con datos actuales
            document.getElementById('editFullName').value = currentUser.profile.full_name || '';
            document.getElementById('editInitials').value = currentUser.profile.custom_initials || '';
            document.getElementById('editUsername').value = currentUser.profile.username || '';
            document.getElementById('editBio').value = currentUser.profile.bio || '';
            document.getElementById('editAvatarUrl').value = currentUser.profile.avatar_url || '';
            
            document.getElementById('editProfileModal').classList.add('active');
        }

        function closeEditProfileModal() {
            document.getElementById('editProfileModal').classList.remove('active');
        }

        async function handleEditProfile(event) {
            event.preventDefault();
            
            const submitButton = event.target.querySelector('.form-submit');
            submitButton.disabled = true;
            submitButton.textContent = 'Guardando...';
            
            try {
                const updates = {
                    full_name: document.getElementById('editFullName').value,
                    custom_initials: document.getElementById('editInitials').value.toUpperCase(),
                    username: document.getElementById('editUsername').value,
                    bio: document.getElementById('editBio').value,
                    avatar_url: document.getElementById('editAvatarUrl').value,
                    updated_at: new Date().toISOString()
                };
                
                // Verificar si el username ya existe (si cambió)
                if (updates.username !== currentUser.profile.username) {
                    const { data: existingUser } = await supabaseClient
                        .from('profiles')
                        .select('username')
                        .eq('username', updates.username)
                        .neq('id', currentUser.id)
                        .single();
                    
                    if (existingUser) {
                        throw new Error('El nombre de usuario ya está en uso');
                    }
                }
                
                const { error } = await supabaseClient
                    .from('profiles')
                    .update(updates)
                    .eq('id', currentUser.id);
                
                if (error) throw error;
                
                // Actualizar el perfil local
                currentUser.profile = { ...currentUser.profile, ...updates };
                
                closeEditProfileModal();
                showUploadStatus('Perfil actualizado correctamente', 'success');
                
                // Actualizar la UI
                await updateProfileHeader();
                renderAllSections();
                
                // Actualizar el botón de auth
                document.getElementById('authText').textContent = updates.username;
                
            } catch (error) {
                showUploadStatus(error.message, 'error');
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Guardar Cambios';
            }
        }

        // Initialize renders
        initializeApp();

        // Mobile menu toggle
        let menuButton = document.createElement('button');
        menuButton.innerHTML = '☰';
        menuButton.style.cssText = `
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 200;
            background: var(--gradient-accent);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1.5rem;
            width: 48px;
            height: 48px;
            cursor: pointer;
        `;
        
        menuButton.addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('mobile-open');
        });
        
        document.body.appendChild(menuButton);
        
        // Show mobile menu button on small screens
        function checkMobile() {
            if (window.innerWidth <= 768) {
                menuButton.style.display = 'flex';
                menuButton.style.alignItems = 'center';
                menuButton.style.justifyContent = 'center';
            } else {
                menuButton.style.display = 'none';
                document.getElementById('sidebar').classList.remove('mobile-open');
            }
        }
        
        window.addEventListener('resize', checkMobile);
        checkMobile();

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', (e) => {
            const sidebar = document.getElementById('sidebar');
            if (window.innerWidth <= 768 && 
                sidebar.classList.contains('mobile-open') && 
                !sidebar.contains(e.target) && 
                !menuButton.contains(e.target)) {
                sidebar.classList.remove('mobile-open');
            }
        });

        // Fill form with data when editing
        function fillFormWithData(section, item) {
            switch(section) {
                case 'music':
                    document.getElementById('playlistUrl').value = item.url;
                    document.getElementById('playlistName').value = item.name;
                    break;
                case 'movies':
                    document.getElementById('movieTitle').value = item.title;
                    document.getElementById('movieDirector').value = item.director;
                    document.getElementById('movieYear').value = item.year;
                    document.getElementById('movieReview').value = item.review;
                    if (item.rating) {
                        document.getElementById('movieRating').value = item.rating;
                    }
                    break;
                case 'books':
                    document.getElementById('bookTitle').value = item.title;
                    document.getElementById('bookAuthor').value = item.author;
                    document.getElementById('bookReview').value = item.review;
                    if (item.rating) {
                        document.getElementById('bookRating').value = item.rating;
                    }
                    break;
                case 'articles':
                    document.getElementById('articleTitle').value = item.title;
                    document.getElementById('articleContent').value = item.content;
                    break;
            }
        }

        // Add entrance animations
        window.addEventListener('load', () => {
            // Animate hero title letters
            document.querySelectorAll('.hero-title span').forEach((span, i) => {
                span.style.animationDelay = `${i * 0.1}s`;
            });
            
            // Animate section cards
            document.querySelectorAll('.section-card').forEach((card, i) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(30px)';
                setTimeout(() => {
                    card.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, 1000 + (i * 100));
            });
        });

        // Add parallax effect to hero
        document.addEventListener('mousemove', (e) => {
            if (currentSection === 'home') {
                const x = (e.clientX - window.innerWidth / 2) / 50;
                const y = (e.clientY - window.innerHeight / 2) / 50;
                
                document.querySelector('.hero-title').style.transform = `translate(${x}px, ${y}px)`;
                document.querySelector('.bg-animation').style.transform = `translate(${-x}px, ${-y}px) scale(1.1)`;
            }
        });

        // Add loading state for async operations
        function showLoader(element) {
            const loader = document.createElement('div');
            loader.className = 'loader';
            loader.style.margin = '2rem auto';
            element.innerHTML = '';
            element.appendChild(loader);
        }

        // Add smooth scroll behavior
        document.documentElement.style.scrollBehavior = 'smooth';

        // Performance optimization: Intersection Observer for animations
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -100px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        // Observe cards when they're rendered
        function observeCards() {
            document.querySelectorAll('.content-card, .playlist-card, .media-item').forEach(card => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                observer.observe(card);
            });
        }

        // Call after each render
        const originalRenders = [renderMusic, renderMovies, renderBooks, renderArticles, renderPosts, renderMedia];
        [renderMusic, renderMovies, renderBooks, renderArticles, renderPosts, renderMedia].forEach((fn, i) => {
            window[fn.name] = function() {
                originalRenders[i].call(this);
                setTimeout(observeCards, 100);
            };
        });

        // Add ripple effect to buttons
        document.addEventListener('click', (e) => {
            if (e.target.matches('button, .section-card, .nav-item')) {
                const ripple = document.createElement('span');
                const rect = e.target.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;
                
                ripple.style.cssText = `
                    position: absolute;
                    width: ${size}px;
                    height: ${size}px;
                    border-radius: 50%;
                    background: rgba(255, 255, 255, 0.5);
                    left: ${x}px;
                    top: ${y}px;
                    transform: scale(0);
                    animation: ripple 0.6s ease-out;
                    pointer-events: none;
                `;
                
                e.target.style.position = 'relative';
                e.target.style.overflow = 'hidden';
                e.target.appendChild(ripple);
                
                setTimeout(() => ripple.remove(), 600);
            }
        });

        // Add ripple animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes ripple {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html><!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus - Tu Espacio Digital Personal</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-tertiary: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --accent: #6366f1;
            --accent-hover: #818cf8;
            --accent-glow: rgba(99, 102, 241, 0.4);
            --border: rgba(255, 255, 255, 0.1);
            --card-bg: rgba(255, 255, 255, 0.03);
            --card-hover: rgba(255, 255, 255, 0.05);
            --shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            --gradient-accent: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --gradient-hover: linear-gradient(135deg, #818cf8 0%, #a78bfa 100%);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            opacity: 0.3;
            background: radial-gradient(circle at 20% 50%, var(--accent-glow) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 40% 20%, rgba(99, 102, 241, 0.2) 0%, transparent 50%);
            animation: bgPulse 20s ease-in-out infinite;
        }

        @keyframes bgPulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            33% { transform: scale(1.1) rotate(120deg); }
            66% { transform: scale(0.9) rotate(240deg); }
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 80px;
            height: 100vh;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem 0;
            z-index: 100;
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .sidebar:hover {
            width: 260px;
        }

        /* Custom scrollbar for sidebar */
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: transparent;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .sidebar:hover::-webkit-scrollbar-thumb {
            background: var(--accent);
        }

        .logo {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 3rem;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: logoGlow 3s ease-in-out infinite;
            flex-shrink: 0;
        }

        @keyframes logoGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .nav-items {
            flex: 1;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            padding: 0 0.5rem;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .nav-item {
            width: 100%;
            padding: 0.75rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            border-radius: 12px;
            min-height: 56px;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient-accent);
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 0 4px 4px 0;
        }

        .nav-item:hover::before,
        .nav-item.active::before {
            transform: translateX(0);
        }

        .nav-item:hover {
            background: var(--card-bg);
        }

        .nav-item.active {
            background: var(--card-hover);
        }

        .nav-icon {
            min-width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-left: 4px;
        }

        .nav-item:hover .nav-icon {
            transform: scale(1.1);
        }

        .nav-text {
            white-space: nowrap;
            opacity: 0;
            transform: translateX(-20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .sidebar:hover .nav-text {
            opacity: 1;
            transform: translateX(0);
        }

        /* Separador visual para búsqueda */
        .nav-divider {
            width: calc(100% - 2rem);
            height: 1px;
            background: var(--border);
            margin: 0.5rem 1rem;
            flex-shrink: 0;
        }

        /* Auth button container */
        .sidebar-footer {
            margin-top: auto;
            padding: 1rem 0.5rem;
            width: 100%;
            flex-shrink: 0;
        }

        .sidebar-footer .nav-item {
            background: var(--gradient-accent);
            border-radius: 12px;
            margin: 0;
        }

        .sidebar-footer .nav-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
        }

        /* Main Content adjustment */
        .main-content {
            margin-left: 80px;
            min-height: 100vh;
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar:hover ~ .main-content {
            margin-left: 260px;
        }

        /* Main Content */
        .main-content {
            margin-left: 80px;
            min-height: 100vh;
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar:hover ~ .main-content {
            margin-left: 250px;
        }

        /* Hero Section */
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            overflow: hidden;
            padding: 2rem;
        }

        .hero-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: clamp(3rem, 12vw, 8rem);
            font-weight: 700;
            letter-spacing: -2px;
            line-height: 0.9;
            margin-bottom: 1rem;
            position: relative;
            animation: titleSlide 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes titleSlide {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hero-title span {
            display: inline-block;
            animation: letterFloat 3s ease-in-out infinite;
            animation-delay: calc(var(--i) * 0.1s);
        }

        @keyframes letterFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .hero-subtitle {
            font-size: clamp(1rem, 2vw, 1.5rem);
            color: var(--text-secondary);
            font-weight: 300;
            letter-spacing: 10px;
            text-transform: uppercase;
            animation: subtitleFade 1s 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            opacity: 0;
            margin-bottom: 3rem;
        }

        @keyframes subtitleFade {
            to {
                opacity: 1;
                letter-spacing: 15px;
            }
        }

        /* Profile Info Section */
        #profileInfo {
            margin-top: 2rem;
            margin-bottom: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .follow-stats {
            display: flex;
            gap: 2rem;
            margin-bottom: 1rem;
        }

        .stat-item {
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .stat-item:hover {
            transform: scale(1.05);
        }

        .stat-count {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        #followButton {
            padding: 0.75rem 2rem;
            border-radius: 9999px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 120px;
        }

        #followButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
        }

        #followButton.following:hover {
            background: #ef4444 !important;
            border-color: #ef4444 !important;
        }

        #followButton.following:hover::after {
            content: 'Dejar de seguir';
        }

        #followButton.following::after {
            content: 'Siguiendo';
        }

        #followButton.not-following::after {
            content: 'Seguir';
        }

        /* Follows Modal */
        .follows-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .follows-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .follows-modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 70vh;
            overflow-y: auto;
            transform: scale(0.9) translateY(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .follows-modal.active .follows-modal-content {
            transform: scale(1) translateY(0);
        }

        .follows-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .follow-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--card-bg);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .follow-item:hover {
            background: var(--card-hover);
            transform: translateX(5px);
        }

        .follow-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--gradient-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.125rem;
            flex-shrink: 0;
        }

        .follow-info {
            flex: 1;
        }

        .follow-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .follow-username {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* Feed tabs update */
        .feed-tabs {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 1rem;
            overflow-x: auto;
        }

        .feed-tab {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.5rem 1rem;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .feed-tab.active {
            color: var(--text-primary);
            border-bottom: 2px solid var(--accent);
        }

        /* Edit Profile Button */
        .edit-profile-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .edit-profile-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
            transform: translateY(-2px);
        }

        /* Search Section */
        .search-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .search-box {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .search-input {
            flex: 1;
            padding: 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .search-button {
            padding: 1rem 1.5rem;
            background: var(--gradient-accent);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .search-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
        }

        .search-results {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .user-search-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .user-search-card:hover {
            transform: translateX(5px);
            border-color: var(--accent);
            background: var(--card-hover);
        }

        .user-search-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .user-search-info {
            flex: 1;
        }

        .user-search-name {
            font-weight: 600;
            font-size: 1.125rem;
            margin-bottom: 0.25rem;
        }

        .user-search-username {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .user-search-stats {
            display: flex;
            gap: 1.5rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .follow-button-small {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 100px;
        }

        .follow-button-small.following {
            background: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
        }

        .follow-button-small.not-following {
            background: var(--gradient-accent);
            border: none;
            color: white;
        }

        .follow-button-small.following::after {
            content: 'Siguiendo';
        }

        .follow-button-small.not-following::after {
            content: 'Seguir';
        }

        .follow-button-small.following:hover {
            background: #ef4444;
            border-color: #ef4444;
            color: white;
        }

        .follow-button-small.following:hover::after {
            content: 'Dejar de seguir';
        }

        /* Rest of the original CSS continues... */
        .section-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
            width: 100%;
            max-width: 800px;
            padding: 0 1rem;
        }

        .section-card {
            aspect-ratio: 1;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 140px;
        }

        .section-card::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translate(-50%, -50%);
        }

        .section-card:hover::before {
            width: 300px;
            height: 300px;
        }

        .section-card:hover {
            transform: translateY(-10px) scale(1.02);
            border-color: var(--accent);
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.3);
        }

        .section-icon {
            font-size: 2.5rem;
            z-index: 1;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .section-card:hover .section-icon {
            transform: rotateY(360deg) scale(1.2);
        }

        .section-label {
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.75rem;
            z-index: 1;
        }

        /* Content Sections */
        .content-section {
            min-height: 100vh;
            padding: 2rem;
            display: none;
            animation: sectionFadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @media (min-width: 768px) {
            .content-section {
                padding: 4rem;
            }
        }

        .content-section.active {
            display: block;
        }

        @keyframes sectionFadeIn {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .section-header {
            margin-bottom: 3rem;
            position: relative;
        }

        .section-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .section-description {
            color: var(--text-secondary);
            font-size: 1.125rem;
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
        }

        .content-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            cursor: pointer;
        }

        .content-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent 0%, var(--accent-glow) 100%);
            opacity: 0;
            transition: opacity 0.4s;
        }

        .content-card:hover {
            transform: translateY(-8px);
            border-color: var(--accent);
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.2);
        }

        .content-card:hover::after {
            opacity: 0.1;
        }

        .card-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .content-card:hover .card-image {
            transform: scale(1.05);
        }

        .card-body {
            padding: 1.5rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .card-subtitle {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .card-description {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Star Rating */
        .star-rating {
            display: flex;
            gap: 0.25rem;
            margin: 0.5rem 0;
        }

        .star {
            color: var(--text-secondary);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .star.filled {
            color: #fbbf24;
        }

        .star.preview {
            color: #fde047;
        }

        .star-rating-input {
            display: flex;
            gap: 0.5rem;
            font-size: 1.5rem;
        }

        .star-rating-input .star {
            cursor: pointer;
            transition: all 0.2s;
        }

        .star-rating-input .star:hover {
            transform: scale(1.2);
        }

        /* Floating Action Buttons */
        .fab-container {
            position: fixed;
            right: 2rem;
            bottom: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            z-index: 100;
        }

        .fab {
            width: 60px;
            height: 60px;
            background: var(--gradient-accent);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: none;
        }

        .fab.visible {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.6);
        }

        .fab:active {
            transform: scale(0.95);
        }

        /* Quick Action Buttons */
        .quick-actions {
            position: fixed;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 1rem;
            z-index: 100;
        }

        .quick-action-btn {
            width: 50px;
            height: 50px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 50%;
            color: var(--text-primary);
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .quick-action-btn:hover {
            background: var(--accent);
            border-color: var(--accent);
            transform: translateX(-5px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
        }

        .quick-action-btn .tooltip {
            position: absolute;
            right: 100%;
            margin-right: 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .quick-action-btn:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* Notifications */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .notifications-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100%;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border);
            transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 200;
            overflow-y: auto;
        }

        .notifications-panel.active {
            right: 0;
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.5);
        }

        .notifications-header {
            padding: 2rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-tertiary);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .notifications-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .notifications-list {
            padding: 1rem;
        }

        .notification-item {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .notification-item:hover {
            background: var(--card-hover);
            transform: translateX(-5px);
        }

        .notification-item.unread {
            border-left: 3px solid var(--accent);
        }

        .notification-content {
            display: flex;
            gap: 1rem;
            align-items: start;
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .notification-text {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .notification-message {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .notification-time {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Custom Page Creator - Diseño Mejorado */
        .custom-page-modal .modal-content {
            max-width: 720px;
            padding: 2.5rem;
        }

        .icon-picker {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(56px, 1fr));
            gap: 0.75rem;
            margin: 1.5rem 0;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 16px;
            max-height: 280px;
            overflow-y: auto;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Scrollbar personalizado */
        .icon-picker::-webkit-scrollbar {
            width: 8px;
        }

        .icon-picker::-webkit-scrollbar-track {
            background: var(--bg-primary);
            border-radius: 4px;
        }

        .icon-picker::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        .icon-picker::-webkit-scrollbar-thumb:hover {
            background: var(--accent);
        }

        .icon-option {
            width: 56px;
            height: 56px;
            border: 2px solid transparent;
            border-radius: 12px;
            background: var(--card-bg);
            cursor: pointer;
            font-size: 1.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .icon-option::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: var(--accent-glow);
            transition: all 0.3s;
            transform: translate(-50%, -50%);
            border-radius: 50%;
        }

        .icon-option:hover {
            background: var(--card-hover);
            border-color: var(--border);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
        }

        .icon-option:hover::before {
            width: 100%;
            height: 100%;
        }

        .icon-option.selected {
            background: var(--gradient-accent);
            border-color: transparent;
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .icon-option.selected::after {
            content: '✓';
            position: absolute;
            bottom: 2px;
            right: 2px;
            font-size: 0.75rem;
            background: white;
            color: var(--accent);
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .content-type-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .content-type-option {
            padding: 1.5rem 1rem;
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .content-type-option::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--gradient-accent);
            border-radius: 16px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: -1;
        }

        .content-type-option:hover {
            background: var(--card-hover);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        .content-type-option.selected {
            background: rgba(99, 102, 241, 0.1);
            border-color: transparent;
            transform: scale(1.02);
        }

        .content-type-option.selected::before {
            opacity: 1;
        }

        .content-type-option.selected .content-type-icon {
            transform: scale(1.1);
        }

        .content-type-icon {
            font-size: 2.5rem;
            margin-bottom: 0.75rem;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .content-type-label {
            font-weight: 600;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
        }

        /* Mejoras adicionales al formulario */
        .form-group {
            margin-bottom: 2rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
            text-transform: none;
            letter-spacing: 0.5px;
        }

        .form-input,
        .form-textarea {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid var(--border);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .form-input:hover,
        .form-textarea:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .form-submit {
            margin-top: 2rem;
            padding: 1.25rem 2rem;
            font-size: 1.125rem;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3);
        }

        /* Modal - Diseño Mejorado */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 2rem;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 3rem;
            max-width: 600px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            transform: scale(0.9) translateY(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal.active .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 1.75rem;
            font-weight: 700;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.05);
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            transform: rotate(90deg) scale(1.1);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-submit {
            width: 100%;
            padding: 1rem;
            background: var(--gradient-accent);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .form-submit:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        }

        .form-submit:active:not(:disabled) {
            transform: translateY(0);
        }

        .form-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .form-submit.loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            margin: auto;
            border: 2px solid transparent;
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
        }

        /* Posts Section - Clean Twitter Style */
        .posts-container {
            max-width: 600px;
            margin: 0 auto;
            border-left: 1px solid var(--border);
            border-right: 1px solid var(--border);
        }

        .post-composer {
            background: transparent;
            border-bottom: 1px solid var(--border);
            padding: 1rem;
            margin-bottom: 0;
        }

        .post-composer-header {
            display: flex;
            gap: 0.75rem;
            width: 100%;
        }

        .post-composer-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--gradient-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.125rem;
            flex-shrink: 0;
        }

        .post-composer-input {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .post-textarea {
            width: 100%;
            padding: 0.75rem 0;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 1.25rem;
            resize: none;
            min-height: 30px;
            margin-bottom: 1rem;
            font-family: inherit;
            line-height: 1.5;
            font-weight: 400;
        }

        .post-textarea:focus {
            outline: none;
        }

        .post-textarea::placeholder {
            color: rgb(113, 118, 123);
            font-weight: 400;
        }

        .post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border);
        }

        .post-actions-left {
            display: flex;
            gap: 0;
            margin-left: -8px;
        }

        .post-media-button {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
            font-size: 1.25rem;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
        }

        .post-media-button:hover {
            background: rgba(99, 102, 241, 0.1);
        }

        .post-button {
            padding: 0.5rem 1rem;
            background: var(--accent);
            border: none;
            border-radius: 9999px;
            color: white;
            font-weight: 700;
            font-size: 0.9375rem;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 36px;
            min-height: 36px;
        }

        .post-button:hover:not(:disabled) {
            background: var(--accent-hover);
        }

        .post-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgb(83, 100, 113);
        }

        /* Post Feed */
        .posts-feed {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .post {
            background: transparent;
            border-bottom: 1px solid var(--border);
            padding: 0.75rem 1rem;
            transition: background 0.2s;
            cursor: pointer;
            position: relative;
        }

        .post:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .post-wrapper {
            display: flex;
            gap: 0.75rem;
        }

        .post-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--gradient-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.125rem;
            flex-shrink: 0;
        }

        .post-main {
            flex: 1;
            min-width: 0;
        }

        .post-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.25rem;
        }

        .post-author-line {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            flex-wrap: wrap;
        }

        .post-author {
            font-weight: 700;
            font-size: 0.9375rem;
            letter-spacing: 0;
        }

        .post-username {
            color: rgb(113, 118, 123);
            font-size: 0.9375rem;
            font-weight: 400;
        }

        .post-date {
            color: rgb(113, 118, 123);
            font-size: 0.9375rem;
            font-weight: 400;
        }

        .post-date::before {
            content: ' · ';
        }

        .post-content {
            line-height: 1.5;
            font-size: 0.9375rem;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-bottom: 0.75rem;
            font-weight: 400;
            color: var(--text-primary);
        }

        .post-media {
            margin-top: 0.75rem;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgb(47, 51, 54);
            max-height: 510px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
        }

        .post-media img,
        .post-media video {
            width: 100%;
            height: auto;
            max-height: 510px;
            object-fit: cover;
            display: block;
        }

        /* Action Menu */
        .post-menu-button {
            background: none;
            border: none;
            color: rgb(113, 118, 123);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.2s;
            font-size: 1.125rem;
            width: 34px;
            height: 34px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .post-menu-button:hover {
            background: rgba(29, 155, 240, 0.1);
            color: var(--accent);
        }

        .post-menu-button:hover {
            background: var(--card-hover);
            color: var(--text-primary);
        }

        .post-menu-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0.5rem;
            min-width: 160px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s;
            z-index: 10;
        }

        .post-menu.active .post-menu-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .post-menu-item {
            display: block;
            width: 100%;
            padding: 0.5rem 0.75rem;
            background: none;
            border: none;
            color: var(--text-primary);
            text-align: left;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .post-menu-item:hover {
            background: var(--card-hover);
        }

        .post-menu-item.delete {
            color: #ef4444;
        }

        /* Media Gallery */
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .media-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            background: var(--card-bg);
            border: 1px solid var(--border);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .media-item:hover {
            transform: scale(1.05);
            border-color: var(--accent);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .media-item img,
        .media-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .media-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.7) 100%);
            opacity: 0;
            transition: opacity 0.3s;
            display: flex;
            align-items: flex-end;
            padding: 1rem;
        }

        .media-item:hover .media-overlay {
            opacity: 1;
        }

        /* Playlist Card */
        .playlist-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .playlist-card:hover {
            border-color: var(--accent);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.2);
        }

        .playlist-embed {
            margin-top: 1rem;
            border-radius: 8px;
            overflow: hidden;
        }

        /* Lightbox */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .lightbox.active {
            opacity: 1;
            visibility: visible;
        }

        .lightbox-content {
            max-width: 90%;
            max-height: 90%;
            position: relative;
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .lightbox.active .lightbox-content {
            transform: scale(1);
        }

        .lightbox-close {
            position: absolute;
            top: -40px;
            right: 0;
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .lightbox-close:hover {
            transform: scale(1.2) rotate(90deg);
        }

        /* Action Buttons - Updated */
        .action-buttons {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            display: flex;
            gap: 0.5rem;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 10;
        }

        .content-card:hover .action-buttons,
        .playlist-card:hover .action-buttons,
        .media-item:hover .action-buttons {
            opacity: 1;
        }

        .action-btn {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: var(--accent);
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .action-btn.delete:hover {
            background: #ef4444;
            border-color: #ef4444;
        }

        /* Loading Animation */
        .loader {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 250px;
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .hero-title {
                font-size: clamp(3rem, 20vw, 6rem);
            }
            
            .section-grid {
                grid-template-columns: repeat(2, 1fr);
                padding: 1rem;
            }
            
            .content-section {
                padding: 1rem;
            }
        }

        /* Password Modal */
        .password-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .password-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .password-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .password-modal.active .password-box {
            transform: scale(1);
        }

        .password-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .password-input {
            width: 100%;
            padding: 1rem;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .password-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .password-submit {
            padding: 0.75rem 2rem;
            background: var(--gradient-accent);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .password-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        }

        .password-error {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            display: none;
        }

        .password-error.visible {
            display: block;
        }

        /* Quick Post Modal */
        .quick-post-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .quick-post-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .quick-post-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            transform: scale(0.9) translateY(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .quick-post-modal.active .quick-post-content {
            transform: scale(1) translateY(0);
        }

        .quick-post-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .quick-post-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .quick-post-composer {
            display: flex;
            gap: 1rem;
        }

        .quick-post-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--gradient-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.125rem;
            flex-shrink: 0;
        }

        .quick-post-input-area {
            flex: 1;
        }

        .quick-post-textarea {
            width: 100%;
            min-height: 120px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 1.125rem;
            resize: none;
            font-family: inherit;
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        .quick-post-textarea:focus {
            outline: none;
        }

        .quick-post-textarea::placeholder {
            color: rgb(113, 118, 123);
        }

        .quick-post-media-preview {
            margin-bottom: 1rem;
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            max-height: 300px;
            display: none;
        }

        .quick-post-media-preview img,
        .quick-post-media-preview video {
            width: 100%;
            height: auto;
            display: block;
        }

        .quick-post-media-remove {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(0, 0, 0, 0.8);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .quick-post-media-remove:hover {
            background: #ef4444;
        }

        .quick-post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .quick-post-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .quick-post-submit {
            padding: 0.5rem 1.5rem;
            background: var(--gradient-accent);
            border: none;
            border-radius: 9999px;
            color: white;
            font-weight: 700;
            font-size: 0.9375rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-post-submit:hover:not(:disabled) {
            background: var(--gradient-hover);
            transform: translateY(-2px);
        }

        .quick-post-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .quick-post-cancel {
            padding: 0.5rem 1.5rem;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 9999px;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.9375rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-post-cancel:hover {
            border-color: var(--text-primary);
            color: var(--text-primary);
        }

        /* Upload Status */
        .upload-status {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem 2rem;
            display: none;
            align-items: center;
            gap: 1rem;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .upload-status.show {
            display: flex;
        }

        .upload-status.success {
            border-color: #10b981;
        }

        .upload-status.error {
            border-color: #ef4444;
        }

        .upload-status-icon {
            font-size: 1.5rem;
        }

        .upload-status.success .upload-status-icon {
            color: #10b981;
        }

        .upload-status.error .upload-status-icon {
            color: #ef4444;
        }

        .upload-status-text {
            font-weight: 500;
        }

        /* Landing Page Styles */
        .landing-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            z-index: 3000;
            overflow-y: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            opacity: 1;
            transition: opacity 0.5s ease-out;
        }

        .landing-page.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .landing-content {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }

        .landing-hero {
            text-align: center;
            padding: 3rem 0;
        }

        .landing-logo-container {
            margin-bottom: 3rem;
            animation: fadeInDown 1s ease-out;
        }

        .landing-logo {
            font-family: 'Space Grotesk', sans-serif;
            font-size: clamp(3rem, 8vw, 5rem);
            font-weight: 700;
            letter-spacing: 3px;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            filter: drop-shadow(0 0 30px rgba(99, 102, 241, 0.5));
        }

        .landing-tagline {
            color: var(--text-secondary);
            font-size: 1.125rem;
            letter-spacing: 1px;
            opacity: 0;
            animation: fadeIn 1s 0.5s ease-out forwards;
        }

        .landing-main {
            max-width: 900px;
            margin: 0 auto;
        }

        .landing-title {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 2rem;
            opacity: 0;
            animation: fadeInUp 1s 0.7s ease-out forwards;
        }

        .gradient-text {
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .landing-description {
            font-size: 1.25rem;
            line-height: 1.8;
            color: var(--text-secondary);
            margin-bottom: 3rem;
            opacity: 0;
            animation: fadeInUp 1s 0.9s ease-out forwards;
        }

        .landing-description strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .landing-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
            opacity: 0;
            animation: fadeInUp 1s 1.1s ease-out forwards;
        }

        .landing-feature {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .landing-feature:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            background: var(--card-hover);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.2);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
            filter: drop-shadow(0 0 20px rgba(99, 102, 241, 0.4));
        }

        .landing-feature h3 {
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        .landing-feature p {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .landing-manifesto {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 20px;
            padding: 2.5rem;
            margin-bottom: 3rem;
            position: relative;
            opacity: 0;
            animation: fadeIn 1s 1.3s ease-out forwards;
        }

        .manifesto-text {
            font-size: 1.125rem;
            line-height: 1.8;
            color: var(--text-primary);
            font-style: italic;
            margin-bottom: 1rem;
        }

        .manifesto-quote {
            font-size: 3rem;
            color: var(--accent);
            position: relative;
            top: 10px;
            line-height: 0;
        }

        .manifesto-author {
            text-align: right;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .landing-cta {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            margin-bottom: 4rem;
            flex-wrap: wrap;
            opacity: 0;
            animation: fadeInUp 1s 1.5s ease-out forwards;
        }

        .cta-button {
            padding: 1.25rem 3rem;
            border-radius: 9999px;
            font-size: 1.125rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1px;
            min-width: 220px;
            position: relative;
            overflow: hidden;
        }

        .cta-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .cta-button:hover::before {
            width: 300px;
            height: 300px;
        }

        .cta-button.primary {
            background: var(--gradient-accent);
            border: none;
            color: white;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .cta-button.primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.4);
        }

        .cta-button.secondary {
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
        }

        .cta-button.secondary:hover {
            background: var(--accent);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .landing-stats {
            display: flex;
            justify-content: center;
            gap: 4rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
            opacity: 0;
            animation: fadeIn 1s 1.7s ease-out forwards;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 700;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .landing-footer {
            text-align: center;
            padding: 2rem 0;
            border-top: 1px solid var(--border);
            opacity: 0;
            animation: fadeIn 1s 1.9s ease-out forwards;
        }

        .landing-footer p:first-child {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            filter: grayscale(0.3);
        }

        .footer-text {
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .landing-features {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .landing-stats {
                gap: 2rem;
            }
            
            .cta-button {
                min-width: 100%;
            }
        }
        .auth-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 1rem;
        }

        .auth-tab {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.5rem 1rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .auth-tab.active {
            color: var(--text-primary);
            border-bottom: 2px solid var(--accent);
        }

        /* Edit Profile Modal */
        #editProfileModal .modal-content {
            max-width: 500px;
        }

        /* Feed Content */
        .feed-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .feed-content {
            min-height: 400px;
        }

        .feed-item-wrapper {
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="logo">NEXUS</div>
        <nav class="nav-items">
            <div class="nav-item active" data-section="home">
                <div class="nav-icon">🏠</div>
                <span class="nav-text">Inicio</span>
            </div>
            <div class="nav-item" data-section="feed">
                <div class="nav-icon">🌐</div>
                <span class="nav-text">Feed Global</span>
            </div>
            <div class="nav-item" data-section="search">
                <div class="nav-icon">🔍</div>
                <span class="nav-text">Buscar</span>
            </div>
            <div class="nav-divider"></div>
            <div class="nav-item" data-section="music">
                <div class="nav-icon">🎵</div>
                <span class="nav-text">Música</span>
            </div>
            <div class="nav-item" data-section="movies">
                <div class="nav-icon">🎬</div>
                <span class="nav-text">Películas</span>
            </div>
            <div class="nav-item" data-section="books">
                <div class="nav-icon">📚</div>
                <span class="nav-text">Libros</span>
            </div>
            <div class="nav-item" data-section="articles">
                <div class="nav-icon">📝</div>
                <span class="nav-text">Artículos</span>
            </div>
            <div class="nav-item" data-section="posts">
                <div class="nav-icon">💭</div>
                <span class="nav-text">Posts</span>
            </div>
            <div class="nav-item" data-section="media">
                <div class="nav-icon">🖼️</div>
                <span class="nav-text">Galería</span>
            </div>
        </nav>
        <div class="sidebar-footer">
            <div class="nav-item" onclick="handleAuthClick()">
                <div class="nav-icon" id="authIcon">👤</div>
                <span class="nav-text" id="authText">Iniciar Sesión</span>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Home Section -->
        <section id="home" class="content-section active">
            <div class="hero">
                <h1 class="hero-title">
                    <span style="--i: 0">👋</span>
                </h1>
                <p class="hero-subtitle" id="heroSubtitle">Bienvenido</p>
                
                <div id="profileInfo"></div>
                
                <div class="section-grid">
                    <div class="section-card" data-navigate="music">
                        <div class="section-icon">🎵</div>
                        <div class="section-label">Música</div>
                    </div>
                    <div class="section-card" data-navigate="movies">
                        <div class="section-icon">🎬</div>
                        <div class="section-label">Películas</div>
                    </div>
                    <div class="section-card" data-navigate="books">
                        <div class="section-icon">📚</div>
                        <div class="section-label">Libros</div>
                    </div>
                    <div class="section-card" data-navigate="articles">
                        <div class="section-icon">📝</div>
                        <div class="section-label">Artículos</div>
                    </div>
                    <div class="section-card" data-navigate="posts">
                        <div class="section-icon">💭</div>
                        <div class="section-label">Posts</div>
                    </div>
                    <div class="section-card" data-navigate="media">
                        <div class="section-icon">🖼️</div>
                        <div class="section-label">Galería</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Feed Global Section -->
        <section id="feed" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Feed Global</h2>
                <p class="section-description">Descubre lo que otros están compartiendo</p>
            </div>
            <div class="feed-container">
                <!-- Feed Tabs -->
                <div class="feed-tabs">
                    <button class="feed-tab active" onclick="switchFeedTab('all')" data-tab="all">Todo</button>
                    <button class="feed-tab" onclick="switchFeedTab('following')" data-tab="following">Siguiendo</button>
                    <button class="feed-tab" onclick="switchFeedTab('posts')" data-tab="posts">Posts</button>
                    <button class="feed-tab" onclick="switchFeedTab('movies')" data-tab="movies">Películas</button>
                    <button class="feed-tab" onclick="switchFeedTab('books')" data-tab="books">Libros</button>
                    <button class="feed-tab" onclick="switchFeedTab('articles')" data-tab="articles">Artículos</button>
                    <button class="feed-tab" onclick="switchFeedTab('music')" data-tab="music">Música</button>
                </div>
                
                <!-- Feed Content -->
                <div id="feedContent" class="feed-content">
                    <!-- El contenido del feed se cargará aquí dinámicamente -->
                </div>
            </div>
        </section>

        <!-- Search Section -->
        <section id="search" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Buscar Usuarios</h2>
                <p class="section-description">Descubre y conecta con otros usuarios</p>
            </div>
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Buscar por nombre o @username..." class="search-input">
                    <button class="search-button" onclick="searchUsers()">🔍</button>
                </div>
                <div id="searchResults" class="search-results"></div>
            </div>
        </section>

        <!-- Music Section -->
        <section id="music" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Música</h2>
                <p class="section-description">Mi colección de playlists favoritas</p>
            </div>
            <div class="cards-grid" id="musicGrid"></div>
        </section>

        <!-- Movies Section -->
        <section id="movies" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Películas</h2>
                <p class="section-description">Mi catálogo cinematográfico personal</p>
            </div>
            <div class="cards-grid" id="moviesGrid"></div>
        </section>

        <!-- Books Section -->
        <section id="books" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Biblioteca</h2>
                <p class="section-description">Libros que han marcado mi vida</p>
            </div>
            <div class="cards-grid" id="booksGrid"></div>
        </section>

        <!-- Articles Section -->
        <section id="articles" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Artículos</h2>
                <p class="section-description">Pensamientos y reflexiones</p>
            </div>
            <div class="cards-grid" id="articlesGrid"></div>
        </section>

        <!-- Posts Section -->
        <section id="posts" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Posts</h2>
                <p class="section-description">Pensamientos del momento</p>
            </div>
            <div class="posts-container">
                <div class="post-composer" id="postComposer" style="display: none;">
                    <div class="post-composer-header">
                        <div class="post-composer-avatar" id="postComposerAvatar">U</div>
                        <div class="post-composer-input">
                            <textarea class="post-textarea" placeholder="¿Qué está pasando?" id="postContent"></textarea>
                            <div class="post-actions">
                                <div class="post-actions-left">
                                    <input type="file" accept="image/*,video/*" id="postMedia" style="display: none;">
                                    <button class="post-media-button" onclick="document.getElementById('postMedia').click()" title="Media">🖼️</button>
                                </div>
                                <button class="post-button" onclick="createPost()" id="postButton" disabled>Postear</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="posts-feed" id="postsFeed"></div>
            </div>
        </section>

        <!-- Media Section -->
        <section id="media" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Galería</h2>
                <p class="section-description">Momentos capturados en el tiempo</p>
            </div>
            <div class="media-grid" id="mediaGrid"></div>
        </section>
    </main>

    <!-- Floating Action Button -->
    <div class="fab-container">
        <button class="fab" id="fab">+</button>
    </div>

    <!-- Quick Action Buttons -->
    <div class="quick-actions">
        <button class="quick-action-btn" onclick="navigateToSection('search')">
            <span class="tooltip">Buscar usuarios</span>
            🔍
        </button>
        <button class="quick-action-btn" id="notificationBtn" onclick="toggleNotifications()">
            <span class="tooltip">Notificaciones</span>
            <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
            🔔
        </button>
        <button class="quick-action-btn" onclick="openQuickPost()" style="background: var(--gradient-accent); border: none;">
            <span class="tooltip">Publicar post</span>
            ✏️
        </button>
        <button class="quick-action-btn" onclick="openCustomPageModal()">
            <span class="tooltip">Crear página</span>
            📄
        </button>
    </div>

    <!-- Notifications Panel -->
    <div class="notifications-panel" id="notificationsPanel">
        <div class="notifications-header">
            <h3 class="notifications-title">Notificaciones</h3>
            <button class="modal-close" onclick="toggleNotifications()">×</button>
        </div>
        <div class="notifications-list" id="notificationsList">
            <!-- Las notificaciones se cargarán aquí -->
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Añadir</h3>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <form id="modalForm">
                <!-- Dynamic content -->
            </form>
        </div>
    </div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
        <div class="lightbox-content">
            <button class="lightbox-close" onclick="closeLightbox()">×</button>
            <div id="lightboxMedia"></div>
        </div>
    </div>

    <!-- Password Modal -->
    <div class="password-modal" id="passwordModal">
        <div class="password-box">
            <h3 class="password-title">Ingresa la contraseña</h3>
            <input type="password" class="password-input" id="passwordInput" placeholder="••••">
            <button class="password-submit" onclick="checkPassword()">Acceder</button>
            <p class="password-error" id="passwordError">Contraseña incorrecta</p>
        </div>
    </div>

    <!-- Auth Modal (Login/Register) -->
    <div class="modal" id="authModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title" id="authModalTitle">Iniciar Sesión</h3>
                <button class="modal-close" onclick="closeAuthModal()">×</button>
            </div>
            <div id="authForm">
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="switchAuthTab('login')" id="loginTab">Iniciar Sesión</button>
                    <button class="auth-tab" onclick="switchAuthTab('register')" id="registerTab">Registrarse</button>
                </div>
                
                <!-- Login Form -->
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Contraseña</label>
                        <input type="password" class="form-input" id="loginPassword" required>
                    </div>
                    <button type="submit" class="form-submit">Iniciar Sesión</button>
                </form>
                
                <!-- Register Form -->
                <form id="registerForm" style="display: none;" onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label class="form-label">Nombre Completo</label>
                        <input type="text" class="form-input" id="registerName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nombre de Usuario</label>
                        <input type="text" class="form-input" id="registerUsername" required pattern="[a-zA-Z0-9_]+" title="Solo letras, números y guiones bajos">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Contraseña</label>
                        <input type="password" class="form-input" id="registerPassword" required minlength="6">
                    </div>
                    <button type="submit" class="form-submit">Registrarse</button>
                </form>
                
                <div id="authError" style="color: #ef4444; text-align: center; margin-top: 1rem; display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Follows Modal -->
    <div class="follows-modal" id="followsModal">
        <div class="follows-modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="followsModalTitle">Seguidores</h3>
                <button class="modal-close" onclick="closeFollowsModal()">×</button>
            </div>
            <div class="follows-list" id="followsList">
                <!-- Lista de seguidores/seguidos se cargará aquí -->
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal" id="editProfileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Perfil</h3>
                <button class="modal-close" onclick="closeEditProfileModal()">×</button>
            </div>
            <form id="editProfileForm" onsubmit="handleEditProfile(event)">
                <div class="form-group">
                    <label class="form-label">Nombre Completo</label>
                    <input type="text" class="form-input" id="editFullName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Iniciales Personalizadas</label>
                    <input type="text" class="form-input" id="editInitials" maxlength="3" placeholder="Ej: EAC" style="text-transform: uppercase;">
                    <p style="margin-top: 0.5rem; color: var(--text-secondary); font-size: 0.75rem;">
                        Máximo 3 caracteres. Dejar vacío para usar las iniciales del nombre.
                    </p>
                </div>
                <div class="form-group">
                    <label class="form-label">Nombre de Usuario</label>
                    <input type="text" class="form-input" id="editUsername" required pattern="[a-zA-Z0-9_]+" title="Solo letras, números y guiones bajos">
                </div>
                <div class="form-group">
                    <label class="form-label">Biografía</label>
                    <textarea class="form-textarea" id="editBio" rows="4" placeholder="Cuéntanos sobre ti..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Avatar URL</label>
                    <input type="url" class="form-input" id="editAvatarUrl" placeholder="https://ejemplo.com/imagen.jpg">
                    <p style="margin-top: 0.5rem; color: var(--text-secondary); font-size: 0.75rem;">
                        Próximamente: subir imagen directamente
                    </p>
                </div>
                <button type="submit" class="form-submit">Guardar Cambios</button>
            </form>
        </div>
    </div>

    <!-- Quick Post Modal -->
    <div class="quick-post-modal" id="quickPostModal">
        <div class="quick-post-content">
            <div class="quick-post-header">
                <h3 class="quick-post-title">Crear post</h3>
                <button class="modal-close" onclick="closeQuickPost()">×</button>
            </div>
            <div class="quick-post-composer">
                <div class="quick-post-avatar" id="quickPostAvatar">U</div>
                <div class="quick-post-input-area">
                    <textarea class="quick-post-textarea" placeholder="¿Qué está pasando?" id="quickPostContent"></textarea>
                    <div class="quick-post-media-preview" id="quickPostMediaPreview">
                        <button class="quick-post-media-remove" onclick="removeQuickPostMedia()">×</button>
                        <div id="quickPostMediaContainer"></div>
                    </div>
                    <div class="quick-post-actions">
                        <div class="post-actions-left">
                            <input type="file" accept="image/*,video/*" id="quickPostMedia" style="display: none;" onchange="handleQuickPostMedia(event)">
                            <button class="post-media-button" onclick="document.getElementById('quickPostMedia').click()" title="Media">🖼️</button>
                        </div>
                        <div class="quick-post-buttons">
                            <button class="quick-post-cancel" onclick="closeQuickPost()">Cancelar</button>
                            <button class="quick-post-submit" onclick="createQuickPost()" id="quickPostButton" disabled>Publicar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Page Modal -->
    <div class="modal custom-page-modal" id="customPageModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Crear Nueva Página</h3>
                <button class="modal-close" onclick="closeCustomPageModal()">×</button>
            </div>
            <form id="customPageForm" onsubmit="handleCreateCustomPage(event)">
                <div class="form-group">
                    <label class="form-label">Nombre de la página</label>
                    <input type="text" class="form-input" id="customPageName" required placeholder="Mi nueva página">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Selecciona un icono</label>
                    <div class="icon-picker" id="iconPicker">
                        <button type="button" class="icon-option" data-icon="🎨">🎨</button>
                        <button type="button" class="icon-option" data-icon="🎮">🎮</button>
                        <button type="button" class="icon-option" data-icon="🎯">🎯</button>
                        <button type="button" class="icon-option" data-icon="🎪">🎪</button>
                        <button type="button" class="icon-option" data-icon="🎭">🎭</button>
                        <button type="button" class="icon-option" data-icon="🎸">🎸</button>
                        <button type="button" class="icon-option" data-icon="🏆">🏆</button>
                        <button type="button" class="icon-option" data-icon="🌟">🌟</button>
                        <button type="button" class="icon-option" data-icon="💡">💡</button>
                        <button type="button" class="icon-option" data-icon="💎">💎</button>
                        <button type="button" class="icon-option" data-icon="🔥">🔥</button>
                        <button type="button" class="icon-option" data-icon="🌈">🌈</button>
                        <button type="button" class="icon-option" data-icon="🌙">🌙</button>
                        <button type="button" class="icon-option" data-icon="⚡">⚡</button>
                        <button type="button" class="icon-option" data-icon="🦄">🦄</button>
                        <button type="button" class="icon-option" data-icon="🎁">🎁</button>
                        <button type="button" class="icon-option" data-icon="📸">📸</button>
                        <button type="button" class="icon-option" data-icon="🎥">🎥</button>
                        <button type="button" class="icon-option" data-icon="🎤">🎤</button>
                        <button type="button" class="icon-option" data-icon="📱">📱</button>
                        <button type="button" class="icon-option" data-icon="💻">💻</button>
                        <button type="button" class="icon-option" data-icon="🎨">🎨</button>
                        <button type="button" class="icon-option" data-icon="✨">✨</button>
                        <button type="button" class="icon-option" data-icon="🚀">🚀</button>
                    </div>
                    <input type="hidden" id="selectedIcon" value="📄">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Tipo de contenido</label>
                    <div class="content-type-selector">
                        <button type="button" class="content-type-option" data-type="text" onclick="selectContentType('text')">
                            <div class="content-type-icon">📝</div>
                            <div class="content-type-label">Solo texto</div>
                        </button>
                        <button type="button" class="content-type-option" data-type="images" onclick="selectContentType('images')">
                            <div class="content-type-icon">🖼️</div>
                            <div class="content-type-label">Solo imágenes</div>
                        </button>
                        <button type="button" class="content-type-option" data-type="videos" onclick="selectContentType('videos')">
                            <div class="content-type-icon">🎥</div>
                            <div class="content-type-label">Solo videos</div>
                        </button>
                        <button type="button" class="content-type-option selected" data-type="all" onclick="selectContentType('all')">
                            <div class="content-type-icon">🌟</div>
                            <div class="content-type-label">Todo</div>
                        </button>
                    </div>
                    <input type="hidden" id="selectedContentType" value="all">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Descripción (opcional)</label>
                    <textarea class="form-textarea" id="customPageDescription" rows="3" placeholder="¿De qué trata esta página?"></textarea>
                </div>
                
                <button type="submit" class="form-submit">Crear Página</button>
            </form>
        </div>
    </div>

    <!-- Landing/Welcome Page -->
    <div class="landing-page" id="landingPage">
        <div class="landing-content">
            <div class="landing-hero">
                <div class="landing-logo-container">
                    <h1 class="landing-logo">NEXUS</h1>
                    <p class="landing-tagline">La primera red social latinoamericana que conecta de verdad</p>
                </div>
                
                <div class="landing-main">
                    <h2 class="landing-title">
                        <span class="gradient-text">Conoce personas</span><br>
                        <span>por lo que realmente aman</span>
                    </h2>
                    
                    <p class="landing-description">
                        En un mundo dominado por redes sociales extranjeras que monetizan tu información, 
                        <strong>Nexus</strong> nace desde Latinoamérica con una visión diferente: 
                        crear conexiones auténticas basadas en pasiones compartidas.
                    </p>
                    
                    <div class="landing-features">
                        <div class="landing-feature">
                            <div class="feature-icon">🎭</div>
                            <h3>Autenticidad Real</h3>
                            <p>Comparte tus gustos en música, cine, literatura y más. Sin filtros, sin máscaras.</p>
                        </div>
                        
                        <div class="landing-feature">
                            <div class="feature-icon">🛡️</div>
                            <h3>Tu Privacidad Importa</h3>
                            <p>Sin publicidad invasiva. Sin venta de datos. Tu información es tuya y de nadie más.</p>
                        </div>
                        
                        <div class="landing-feature">
                            <div class="feature-icon">🌎</div>
                            <h3>Hecho en LATAM</h3>
                            <p>La primera red social creada por latinos, para latinos. Con nuestra cultura y valores.</p>
                        </div>
                        
                        <div class="landing-feature">
                            <div class="feature-icon">✨</div>
                            <h3>100% Gratuito</h3>
                            <p>Sin planes premium ocultos. Todas las funciones disponibles para todos, siempre.</p>
                        </div>
                    </div>
                    
                    <div class="landing-manifesto">
                        <p class="manifesto-text">
                            <span class="manifesto-quote">"</span>
                            Cansado de que Silicon Valley y Beijing decidan cómo nos conectamos, 
                            creé <strong>Nexus</strong> para devolverle el poder a nuestra gente. 
                            Aquí no eres un producto, eres una persona con historias que contar.
                            <span class="manifesto-quote">"</span>
                        </p>
                        <p class="manifesto-author">— El creador, un latino como tú</p>
                    </div>
                    
                    <div class="landing-cta">
                        <button class="cta-button primary" onclick="showAuthFromLanding('register')">
                            Únete a la Revolución
                        </button>
                        <button class="cta-button secondary" onclick="showAuthFromLanding('login')">
                            Ya tengo cuenta
                        </button>
                    </div>
                    
                    <div class="landing-stats">
                        <div class="stat">
                            <div class="stat-number">0</div>
                            <div class="stat-label">anuncios</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number">0</div>
                            <div class="stat-label">datos vendidos</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number">∞</div>
                            <div class="stat-label">conexiones reales</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="landing-footer">
                <p>🇦🇷 🇧🇴 🇧🇷 🇨🇱 🇨🇴 🇨🇷 🇨🇺 🇩🇴 🇪🇨 🇸🇻 🇬🇹 🇭🇳 🇲🇽 🇳🇮 🇵🇦 🇵🇾 🇵🇪 🇵🇷 🇺🇾 🇻🇪</p>
                <p class="footer-text">Unidos por la cultura, no por algoritmos</p>
            </div>
        </div>
    </div>
    <div class="upload-status" id="uploadStatus">
        <span class="upload-status-icon"></span>
        <span class="upload-status-text"></span>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
            